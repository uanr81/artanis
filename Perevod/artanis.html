<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>GNU Artanis web-framework Manual</title>

<meta name="description" content="GNU Artanis web-framework Manual">
<meta name="keywords" content="GNU Artanis web-framework Manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<link href="#Top" rel="start" title="Top">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<h1 class="settitle" align="center">GNU Artanis web-framework Manual</h1>


<span id="SEC_Contents"></span>
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">

<ul class="no-bullet">
  <li><a id="toc-Introduction-2" href="#Introduction">1 Introduction</a>
  <ul class="no-bullet">
    <li><a id="toc-Conventions-used-in-this-manual-1" href="#Conventions-used-in-this-manual">1.1 Conventions used in this manual</a></li>
    <li><a id="toc-No-warranty-1" href="#No-warranty">1.2 No warranty</a></li>
  </ul></li>
  <li><a id="toc-License-1" href="#License">2 License</a></li>
  <li><a id="toc-Installation-1" href="#Installation">3 Installation</a>
  <ul class="no-bullet">
    <li><a id="toc-For-users-1" href="#For-users">3.1 For users</a></li>
    <li><a id="toc-For-contributors-1" href="#For-contributors">3.2 For contributors</a></li>
  </ul></li>
  <li><a id="toc-Configuration-1" href="#Configuration">4 Configuration</a>
  <ul class="no-bullet">
    <li><a id="toc-Config-APIs-1" href="#Config-APIs">4.1 Config APIs</a></li>
  </ul></li>
  <li><a id="toc-Hello-World-1" href="#Hello-World">5 Hello World</a>
  <ul class="no-bullet">
    <li><a id="toc-Use-Guile-REPL-and-verify-GNU-Artanis-installation-1" href="#Use-Guile-REPL-and-verify-GNU-Artanis-installation">5.1 Use Guile REPL and verify GNU Artanis installation</a></li>
    <li><a id="toc-Simple-HTTP-server-1" href="#Simple-HTTP-server">5.2 Simple HTTP server</a></li>
    <li><a id="toc-Try-simple-URL-remapping-1" href="#Try-simple-URL-remapping">5.3 Try simple URL remapping</a></li>
    <li><a id="toc-More-complex-URL-remapping-1" href="#More-complex-URL-remapping">5.4 More complex URL remapping</a></li>
    <li><a id="toc-Regex-in-URL-remapping-1" href="#Regex-in-URL-remapping">5.5 Regex in URL remapping</a></li>
    <li><a id="toc-Database-operating-1" href="#Database-operating">5.6 Database operating</a></li>
  </ul></li>
  <li><a id="toc-Scheme-Basics-1" href="#Scheme-Basics">6 Scheme Basics</a>
  <ul class="no-bullet">
    <li><a id="toc-For-newbies-1" href="#For-newbies">6.1 For newbies</a></li>
    <li><a id="toc-For-Pythonistas-1" href="#For-Pythonistas">6.2 For Pythonistas</a></li>
    <li><a id="toc-For-Rubyist-1" href="#For-Rubyist">6.3 For Rubyist</a></li>
    <li><a id="toc-For-deep-learners-1" href="#For-deep-learners">6.4 For deep learners</a></li>
  </ul></li>
  <li><a id="toc-GNU-Artanis-Basics-1" href="#GNU-Artanis-Basics">7 GNU Artanis Basics</a>
  <ul class="no-bullet">
    <li><a id="toc-How-to-run-a-site-with-GNU-Artanis-1" href="#How-to-run-a-site-with-GNU-Artanis">7.1 How to run a site with GNU Artanis</a></li>
    <li><a id="toc-Initialization-1" href="#Initialization">7.2 Initialization</a></li>
    <li><a id="toc-Registering-handlers-for-HTTP-methods-1" href="#Registering-handlers-for-HTTP-methods">7.3 Registering handlers for HTTP methods</a></li>
    <li><a id="toc-Emit-a-Response-1" href="#Emit-a-Response">7.4 Emit a Response</a></li>
    <li><a id="toc-Running-the-server-1" href="#Running-the-server">7.5 Running the server</a></li>
    <li><a id="toc-Working-with-Nginx-1" href="#Working-with-Nginx">7.6 Working with Nginx</a></li>
  </ul></li>
  <li><a id="toc-The-Art-command-line-1" href="#The-Art-command-line">8 The Art command line</a>
  <ul class="no-bullet">
    <li><a id="toc-art-create-1" href="#art-create">8.1 art create</a></li>
    <li><a id="toc-art-draw-1" href="#art-draw">8.2 art draw</a></li>
    <li><a id="toc-art-api-1" href="#art-api">8.3 art api</a></li>
    <li><a id="toc-art-migrate-1" href="#art-migrate">8.4 art migrate</a></li>
    <li><a id="toc-art-work-1" href="#art-work">8.5 art work</a></li>
  </ul></li>
  <li><a id="toc-URL-remapping-1" href="#URL-remapping">9 URL remapping</a>
  <ul class="no-bullet">
    <li><a id="toc-Introduction-to-URL-remapping-1" href="#Introduction-to-URL-remapping">9.1 Introduction to URL remapping</a></li>
    <li><a id="toc-URL-handling-1" href="#URL-handling">9.2 URL handling</a></li>
    <li><a id="toc-OPTIONS-method-1" href="#OPTIONS-method">9.3 OPTIONS method</a></li>
    <li><a id="toc-Get-parameters-from-a-URL-1" href="#Get-parameters-from-a-URL">9.4 Get parameters from a URL</a></li>
    <li><a id="toc-Redirecting-1" href="#Redirecting">9.5 Redirecting</a></li>
  </ul></li>
  <li><a id="toc-Route-context-1" href="#Route-context">10 Route context</a>
  <ul class="no-bullet">
    <li><a id="toc-Route-context-APIs-1" href="#Route-context-APIs">10.1 Route context APIs</a></li>
  </ul></li>
  <li><a id="toc-Page-status-handling-1" href="#Page-status-handling">11 Page status handling</a>
  <ul class="no-bullet">
    <li><a id="toc-HTTP-status-code-1" href="#HTTP-status-code">11.1 HTTP status code</a></li>
    <li><a id="toc-The-default-behaviour-of-status-handling-1" href="#The-default-behaviour-of-status-handling">11.2 The default behaviour of status handling</a></li>
    <li><a id="toc-Dynamic-status-page-generating-1" href="#Dynamic-status-page-generating">11.3 Dynamic status page generating</a></li>
  </ul></li>
  <li><a id="toc-MVC-1" href="#MVC">12 MVC</a>
  <ul class="no-bullet">
    <li><a id="toc-Controllers_002fViews-1" href="#Controllers_002fViews">12.1 Controllers/Views</a></li>
    <li><a id="toc-Models-1" href="#Models">12.2 Models</a></li>
  </ul></li>
  <li><a id="toc-Query-String-1" href="#Query-String">13 Query String</a>
  <ul class="no-bullet">
    <li><a id="toc-Query-string-from-GET-1" href="#Query-string-from-GET">13.1 Query string from GET</a></li>
    <li><a id="toc-Query-string-from-POST-1" href="#Query-string-from-POST">13.2 Query string from POST</a></li>
  </ul></li>
  <li><a id="toc-Layouts-and-Rendering-in-GNU-Artanis-1" href="#Layouts-and-Rendering-in-GNU-Artanis">14 Layouts and Rendering in GNU Artanis</a>
  <ul class="no-bullet">
    <li><a id="toc-Templating-1" href="#Templating">14.1 Templating</a></li>
    <li><a id="toc-Templating-for-Pythoners-1" href="#Templating-for-Pythoners">14.2 Templating for Pythoners</a></li>
    <li><a id="toc-Templating-for-Rubyists-1" href="#Templating-for-Rubyists">14.3 Templating for Rubyists</a></li>
    <li><a id="toc-Templating-APIs-1" href="#Templating-APIs">14.4 Templating APIs</a></li>
    <li><a id="toc-Embedded-Templates-1" href="#Embedded-Templates">14.5 Embedded Templates</a>
    <ul class="no-bullet">
      <li><a id="toc-Template-special-commands-1" href="#Template-special-commands">14.5.1 Template special commands</a></li>
    </ul></li>
    <li><a id="toc-SXML-Templates-1" href="#SXML-Templates">14.6 SXML Templates</a></li>
  </ul></li>
  <li><a id="toc-Databases-1" href="#Databases">15 Databases</a>
  <ul class="no-bullet">
    <li><a id="toc-DB-init-hooks-1" href="#DB-init-hooks">15.1 DB init hooks</a></li>
    <li><a id="toc-DB-connection-pool-1" href="#DB-connection-pool">15.2 DB connection pool</a></li>
    <li><a id="toc-Migration-1" href="#Migration">15.3 Migration</a></li>
    <li><a id="toc-ORM-problem-1" href="#ORM-problem">15.4 ORM problem</a></li>
    <li><a id="toc-SSQL-1" href="#SSQL">15.5 SSQL</a></li>
    <li><a id="toc-FPRM-_0028experimental_0029-1" href="#FPRM-_0028experimental_0029">15.6 FPRM (experimental)</a>
    <ul class="no-bullet">
      <li><a id="toc-Connect-to-DB-server-1" href="#Connect-to-DB-server">15.6.1 Connect to DB server</a></li>
      <li><a id="toc-Map-DB-table-1" href="#Map-DB-table">15.6.2 Map DB table</a></li>
      <li><a id="toc-Create-table-1" href="#Create-table">15.6.3 Create table</a></li>
      <li><a id="toc-Get-columns-from-table-1" href="#Get-columns-from-table">15.6.4 Get columns from table</a></li>
      <li><a id="toc-Set-values-to-table-1" href="#Set-values-to-table">15.6.5 Set values to table</a></li>
      <li><a id="toc-Drop-a-table-1" href="#Drop-a-table">15.6.6 Drop a table</a></li>
      <li><a id="toc-Check-existence-of-table-1" href="#Check-existence-of-table">15.6.7 Check existence of table</a></li>
      <li><a id="toc-Get-schema-of-a-table-1" href="#Get-schema-of-a-table">15.6.8 Get schema of a table</a></li>
    </ul></li>
    <li><a id="toc-SQL-Mapping-_0028experimental_0029-1" href="#SQL-Mapping-_0028experimental_0029">15.7 SQL Mapping (experimental)</a></li>
  </ul></li>
  <li><a id="toc-RESTful-API-1" href="#RESTful-API">16 RESTful API</a></li>
  <li><a id="toc-MIME-1" href="#MIME">17 MIME</a>
  <ul class="no-bullet">
    <li><a id="toc-JSON-1" href="#JSON">17.1 JSON</a></li>
    <li><a id="toc-CSV-1" href="#CSV">17.2 CSV</a></li>
    <li><a id="toc-XML-1" href="#XML">17.3 XML</a></li>
    <li><a id="toc-SXML-1" href="#SXML">17.4 SXML</a></li>
  </ul></li>
  <li><a id="toc-Upload-files-1" href="#Upload-files">18 Upload files</a>
  <ul class="no-bullet">
    <li><a id="toc-Receive-an-upload-from-the-client-1" href="#Receive-an-upload-from-the-client">18.1 Receive an upload from the client</a></li>
    <li><a id="toc-Send-an-upload-to-a-Server-1" href="#Send-an-upload-to-a-Server">18.2 Send an upload to a Server</a></li>
  </ul></li>
  <li><a id="toc-Sessions-1" href="#Sessions">19 Sessions</a>
  <ul class="no-bullet">
    <li><a id="toc-Session-backend-1" href="#Session-backend">19.1 Session backend</a></li>
  </ul></li>
  <li><a id="toc-Cookies-1" href="#Cookies">20 Cookies</a></li>
  <li><a id="toc-Authentication-2" href="#Authentication">21 Authentication</a>
  <ul class="no-bullet">
    <li><a id="toc-Init-Authentication-1" href="#Init-Authentication">21.1 Init Authentication</a></li>
    <li><a id="toc-Basic-Authentication-1" href="#Basic-Authentication">21.2 Basic Authentication</a></li>
    <li><a id="toc-Common-Authentication-1" href="#Common-Authentication">21.3 Common Authentication</a></li>
    <li><a id="toc-Login-Authentication-1" href="#Login-Authentication">21.4 Login Authentication</a></li>
    <li><a id="toc-Authenticate-checking-1" href="#Authenticate-checking">21.5 Authenticate checking</a></li>
    <li><a id="toc-Customized-Authentication-1" href="#Customized-Authentication">21.6 Customized Authentication</a></li>
    <li><a id="toc-Websocket-Authentication-1" href="#Websocket-Authentication">21.7 Websocket Authentication</a></li>
    <li><a id="toc-HMAC-1" href="#HMAC">21.8 HMAC</a></li>
  </ul></li>
  <li><a id="toc-Cache-1" href="#Cache">22 Cache</a>
  <ul class="no-bullet">
    <li><a id="toc-On-web-caching-1" href="#On-web-caching">22.1 On web caching</a></li>
    <li><a id="toc-Cache-APIs-1" href="#Cache-APIs">22.2 Cache APIs</a></li>
  </ul></li>
  <li><a id="toc-Shortcuts-1" href="#Shortcuts">23 Shortcuts</a>
  <ul class="no-bullet">
    <li><a id="toc-What-is-shortcuts_003f-1" href="#What-is-shortcuts_003f">23.1 What is shortcuts?</a></li>
    <li><a id="toc-Database-connection-1" href="#Database-connection">23.2 Database connection</a></li>
    <li><a id="toc-Raw-SQL-1" href="#Raw-SQL">23.3 Raw SQL</a></li>
    <li><a id="toc-String-template-1" href="#String-template">23.4 String template</a></li>
    <li><a id="toc-SQL_002dMapping-shortcut-_0028unfinished_0029-1" href="#SQL_002dMapping-shortcut-_0028unfinished_0029">23.5 SQL-Mapping shortcut (unfinished)</a></li>
    <li><a id="toc-Authentication-3" href="#Authentication-1">23.6 Authentication</a></li>
  </ul></li>
  <li><a id="toc-Websocket-_0028Experimental_0029-1" href="#Websocket-_0028Experimental_0029">24 Websocket (Experimental)</a>
  <ul class="no-bullet">
    <li><a id="toc-Websocket-introduction-1" href="#Websocket-introduction">24.1 Websocket introduction</a></li>
    <li><a id="toc-Websocket-basic-usage-1" href="#Websocket-basic-usage">24.2 Websocket basic usage</a></li>
    <li><a id="toc-Websocket-named_002dpipe-1" href="#Websocket-named_002dpipe">24.3 Websocket named-pipe</a></li>
    <li><a id="toc-Websocket-APIs-1" href="#Websocket-APIs">24.4 Websocket APIs</a>
    <ul class="no-bullet">
      <li><a id="toc-Websocket-configuration-1" href="#Websocket-configuration">24.4.1 Websocket configuration</a></li>
      <li><a id="toc-Websocket-application-1" href="#Websocket-application">24.4.2 Websocket application</a></li>
    </ul></li>
    <li><a id="toc-Websocket-frame-1" href="#Websocket-frame">24.5 Websocket frame</a></li>
    <li><a id="toc-Websocket-opcode-1" href="#Websocket-opcode">24.6 Websocket opcode</a></li>
    <li><a id="toc-Websocket-authentication-1" href="#Websocket-authentication">24.7 Websocket authentication</a></li>
  </ul></li>
  <li><a id="toc-Ragnarok-server-core-1" href="#Ragnarok-server-core">25 Ragnarok server core</a>
  <ul class="no-bullet">
    <li><a id="toc-Introduction-3" href="#Introduction-1">25.1 Introduction</a></li>
    <li><a id="toc-Principles-1" href="#Principles">25.2 Principles</a></li>
    <li><a id="toc-Features-1" href="#Features">25.3 Features</a></li>
    <li><a id="toc-Ragnarok-APIs-1" href="#Ragnarok-APIs">25.4 Ragnarok APIs</a></li>
  </ul></li>
  <li><a id="toc-Key_002dValue-Database-1" href="#Key_002dValue-Database">26 Key-Value Database</a>
  <ul class="no-bullet">
    <li><a id="toc-LPC-1" href="#LPC">26.1 LPC</a></li>
  </ul></li>
  <li><a id="toc-Utils-1" href="#Utils">27 Utils</a>
  <ul class="no-bullet">
    <li><a id="toc-String-Template-1" href="#String-Template">27.1 String Template</a></li>
    <li><a id="toc-Random-String-Generator-1" href="#Random-String-Generator">27.2 Random String Generator</a></li>
    <li><a id="toc-Cryptographic-hash-functions-1" href="#Cryptographic-hash-functions">27.3 Cryptographic hash functions</a></li>
    <li><a id="toc-Stack-_0026-Queue-1" href="#Stack-_0026-Queue">27.4 Stack &amp; Queue</a></li>
    <li><a id="toc-Useful-string-operation-1" href="#Useful-string-operation">27.5 Useful string operation</a></li>
    <li><a id="toc-Time-operation-tool-1" href="#Time-operation-tool">27.6 Time operation tool</a></li>
  </ul></li>
  <li><a id="toc-Integrate-front_002dend-framework-1" href="#Integrate-front_002dend-framework">28 Integrate front-end framework</a>
  <ul class="no-bullet">
    <li><a id="toc-React-_002b-Typescript-1" href="#React-_002b-Typescript">28.1 React + Typescript</a></li>
  </ul></li>
  <li><a id="toc-Debug-mode-1" href="#Debug-mode">29 Debug mode</a></li>
  <li><a id="toc-Appendix-A-GNU-Free-Documentation-License-1" href="#Appendix-A-GNU-Free-Documentation-License">30 Appendix A GNU Free Documentation License</a></li>
</ul>
</div>


<span id="Top"></span><div class="header">
<p>
Next: <a href="#Introduction" accesskey="n" rel="next">Introduction</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="GNU-Artanis-web_002dframework-Manual"></span><h1 class="top">GNU Artanis web-framework Manual</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Introduction" accesskey="1">Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#License" accesskey="2">License</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Installation" accesskey="3">Installation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Configuration" accesskey="4">Configuration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Hello-World" accesskey="5">Hello World</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Scheme-Basics" accesskey="6">Scheme Basics</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#GNU-Artanis-Basics" accesskey="7">GNU Artanis Basics</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-Art-command-line" accesskey="8">The Art command line</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#URL-remapping" accesskey="9">URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Route-context">Route context</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Page-status-handling">Page status handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#MVC">MVC</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Query-String">Query String</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Layouts-and-Rendering-in-GNU-Artanis">Layouts and Rendering in GNU Artanis</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Databases">Databases</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#RESTful-API">RESTful API</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#MIME">MIME</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Upload-files">Upload files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Sessions">Sessions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cookies">Cookies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authentication">Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cache">Cache</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Shortcuts">Shortcuts</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-_0028Experimental_0029">Websocket (Experimental)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Ragnarok-server-core">Ragnarok server core</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Key_002dValue-Database">Key-Value Database</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Utils">Utils</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Integrate-front_002dend-framework">Integrate front-end framework</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Debug-mode">Debug mode</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Appendix-A-GNU-Free-Documentation-License">Appendix A GNU Free Documentation License</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

</pre></th></tr><tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">&mdash; The Detailed Node Listing &mdash;

Introduction

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Conventions-used-in-this-manual">Conventions used in this manual</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#No-warranty">No warranty</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Installation

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#For-users">For users</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-contributors">For contributors</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Configuration

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Config-APIs">Config APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Hello World

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Use-Guile-REPL-and-verify-GNU-Artanis-installation">Use Guile REPL and verify GNU Artanis installation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Simple-HTTP-server">Simple HTTP server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Try-simple-URL-remapping">Try simple URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#More-complex-URL-remapping">More complex URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Regex-in-URL-remapping">Regex in URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Database-operating">Database operating</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Scheme Basics

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#For-newbies">For newbies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-Pythonistas">For Pythonistas</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-Rubyist">For Rubyist</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-deep-learners">For deep learners</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

GNU Artanis Basics

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#How-to-run-a-site-with-GNU-Artanis">How to run a site with GNU Artanis</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Initialization">Initialization</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Registering-handlers-for-HTTP-methods">Registering handlers for HTTP methods</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Emit-a-Response">Emit a Response</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Running-the-server">Running the server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Working-with-Nginx">Working with Nginx</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

The Art command line

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#art-create">art create</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-draw">art draw</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-api">art api</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-migrate">art migrate</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-work">art work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

URL remapping

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Introduction-to-URL-remapping">Introduction to URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#URL-handling">URL handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#OPTIONS-method">OPTIONS method</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Get-parameters-from-a-URL">Get parameters from a URL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Redirecting">Redirecting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Route context

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Route-context-APIs">Route context APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Page status handling

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#HTTP-status-code">HTTP status code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-default-behaviour-of-status-handling">The default behaviour of status handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Dynamic-status-page-generating">Dynamic status page generating</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

MVC

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Controllers_002fViews">Controllers/Views</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Models">Models</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Query String

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Query-string-from-GET">Query string from GET</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Query-string-from-POST">Query string from POST</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Layouts and Rendering in GNU Artanis

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Templating">Templating</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Templating-for-Pythoners">Templating for Pythoners</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Templating-for-Rubyists">Templating for Rubyists</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Templating-APIs">Templating APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Embedded-Templates">Embedded Templates</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SXML-Templates">SXML Templates</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Embedded Templates

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Template-special-commands">Template special commands</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Databases

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#DB-init-hooks">DB init hooks</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#DB-connection-pool">DB connection pool</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Migration">Migration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#ORM-problem">ORM problem</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SSQL">SSQL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#FPRM-_0028experimental_0029">FPRM (experimental)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SQL-Mapping-_0028experimental_0029">SQL Mapping (experimental)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

FPRM (experimental)

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Connect-to-DB-server">Connect to DB server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Map-DB-table">Map DB table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Create-table">Create table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Get-columns-from-table">Get columns from table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Set-values-to-table">Set values to table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Drop-a-table">Drop a table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Check-existence-of-table">Check existence of table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Get-schema-of-a-table">Get schema of a table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

MIME

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#JSON">JSON</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#CSV">CSV</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#XML">XML</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SXML">SXML</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Upload files

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Receive-an-upload-from-the-client">Receive an upload from the client</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Send-an-upload-to-a-Server">Send an upload to a Server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Sessions

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Session-backend">Session backend</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Authentication

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Init-Authentication">Init Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Basic-Authentication">Basic Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Common-Authentication">Common Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Login-Authentication">Login Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authenticate-checking">Authenticate checking</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Customized-Authentication">Customized Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-Authentication">Websocket Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#HMAC">HMAC</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Cache

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#On-web-caching">On web caching</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cache-APIs">Cache APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Shortcuts

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#What-is-shortcuts_003f">What is shortcuts?</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Database-connection">Database connection</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Raw-SQL">Raw SQL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#String-template">String template</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SQL_002dMapping-shortcut-_0028unfinished_0029">SQL-Mapping shortcut (unfinished)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authentication-1">Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Websocket (Experimental)

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Websocket-introduction">Websocket introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-basic-usage">Websocket basic usage</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-named_002dpipe">Websocket named-pipe</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-APIs">Websocket APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-frame">Websocket frame</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-opcode">Websocket opcode</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-authentication">Websocket authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Websocket APIs

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Websocket-configuration">Websocket configuration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-application">Websocket application</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Ragnarok server core

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#Introduction-1">Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Principles">Principles</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Features">Features</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Ragnarok-APIs">Ragnarok APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Key-Value Database

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#LPC">LPC</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Utils

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#String-Template">String Template</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Random-String-Generator">Random String Generator</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cryptographic-hash-functions">Cryptographic hash functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Stack-_0026-Queue">Stack &amp; Queue</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Useful-string-operation">Useful string operation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Time-operation-tool">Time operation tool</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

Integrate front-end framework

</pre></th></tr><tr><td align="left" valign="top">&bull; <a href="#React-_002b-Typescript">React + Typescript</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">

</pre></th></tr></table>

<hr>
<span id="Introduction"></span><div class="header">
<p>
Next: <a href="#License" accesskey="n" rel="next">License</a>, Previous: <a href="#Top" accesskey="p" rel="prev">Top</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Introduction-2"></span><h2 class="chapter">1 Introduction</h2>

<div class="example">
<pre class="example">Copyright (C)  2018  Mu Lei known as NalaGinrut.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is included in the section entitled 'GNU
Free Documentation License'.
</pre></div>

<p>This manual documents GNU Artanis, a fast, monolithithic web framework of Scheme.
</p>
<p>A <a href="http://en.wikipedia.org/wiki/Web_application_framework">web application framework (WAF)</a> is a software framework that is designed to support the development of dynamic websites,
web applications, web services and web resources.
This framework aims to alleviate the overhead associated with common activities in web development.
GNU Artanis provides several tools for web development: database access, templating frameworks, session management, <a href="http://en.wikipedia.org/wiki/Rewrite_engine">URL-remapping</a> for <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a>, page caching, and more.
</p>
<p>Guile is the GNU Ubiquitous Intelligent Language for Extensions, the official extension language for the <a href="http://www.gnu.org/">GNU operating system</a>.
Guile is also an interpreter and compiler for other dynamic programming languages including Scheme.
</p>
<p><a href="http://en.wikipedia.org/wiki/Scheme_%28programming_language%29">Scheme</a> is a functional programming language and one of the two main dialects of the programming language <a href="http://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a>.
Scheme follows a minimalist design philosophy specifying a small standard core with powerful tools for language extension.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Conventions-used-in-this-manual" accesskey="1">Conventions used in this manual</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#No-warranty" accesskey="2">No warranty</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Conventions-used-in-this-manual"></span><div class="header">
<p>
Next: <a href="#No-warranty" accesskey="n" rel="next">No warranty</a>, Up: <a href="#Introduction" accesskey="u" rel="up">Introduction</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Conventions-used-in-this-manual-1"></span><h3 class="section">1.1 Conventions used in this manual</h3>

<p>In this manual the following syntax is used to demonstrate the use of the API:
</p><div class="example">
<pre class="example">(api-name arg1 arg2 #:key0 val0 ... [optional-arg1 &lt;- default-value1] ...)
</pre></div>
<p>If you are new to Scheme, it is recommended that you read the [BROKEN LINK: Basic in Scheme] chapter first.
</p>
<hr>
<span id="No-warranty"></span><div class="header">
<p>
Previous: <a href="#Conventions-used-in-this-manual" accesskey="p" rel="prev">Conventions used in this manual</a>, Up: <a href="#Introduction" accesskey="u" rel="up">Introduction</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="No-warranty-1"></span><h3 class="section">1.2 No warranty</h3>

<p>We distribute software in the hope that it will be useful, but without any warranty. No author or distributor of this software accepts responsibility to anyone for the consequences of using it or for whether it serves any particular purpose or works at all, unless they say so in writing. This is exactly the same warranty that proprietary software companies offer: none.
</p>
<hr>
<span id="License"></span><div class="header">
<p>
Next: <a href="#Installation" accesskey="n" rel="next">Installation</a>, Previous: <a href="#Introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="License-1"></span><h2 class="chapter">2 License</h2>

<p>GNU Artanis is <a href="http://www.gnu.org/philosophy/free-sw.html">Free Software</a>. GNU Artanis is under the terms of the GNU GPLv3+ and GNU LGPLv3+.
See the files COPYING and COPYING.LESSER in toplevel of source code.
</p>
<p>This manual is published under the terms of the <a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</a> 1.3 or later.
</p>
<p><strong>You must be aware there is no warranty whatsoever for GNU Artanis. This is described in full in the
This is described in full in the licenses.</strong>
</p>
<hr>
<span id="Installation"></span><div class="header">
<p>
Next: <a href="#Configuration" accesskey="n" rel="next">Configuration</a>, Previous: <a href="#License" accesskey="p" rel="prev">License</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Installation-1"></span><h2 class="chapter">3 Installation</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#For-users" accesskey="1">For users</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-contributors" accesskey="2">For contributors</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="For-users"></span><div class="header">
<p>
Next: <a href="#For-contributors" accesskey="n" rel="next">For contributors</a>, Up: <a href="#Installation" accesskey="u" rel="up">Installation</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="For-users-1"></span><h3 class="section">3.1 For users</h3>

<p><strong>Install GNU Guile-2.2.2 or higher version:</strong>
</p>
<p>Since GNU Artanis-0.2, the GNU Guile-2.2+ is required because of the <a href="https://www.gnu.org/software/guile/manual/html_node/Non_002dBlocking-I_002fO.html">suspendable-ports</a>, which is the key to implement asynchronous
non-blocking server core in GNU Artanis.
</p>
<div class="example">
<pre class="example">wget -c ftp://ftp.gnu.org/gnu/guile/guile-2.2.2.tar.xz
tar xvf guile-2.2.2.tar.xz
cd guile-2.2.2 &amp;&amp; ./configure &amp;&amp; make #(NOTE: this may take very long time even looks like halting)
sudo make install
</pre></div>

<p>I would NOT recommend you trying to compile/install Guile from Git repo, since it&rsquo;ll take too much time of you.
</p>
<p><strong>Install dependencies:</strong>
</p>
<ul>
<li> guile-dbi-2.1.7 (The tarball included guile-dbd) <strong>[Optional]</strong>
</li></ul>
<div class="example">
<pre class="example">wget -c https://github.com/opencog/guile-dbi/archive/guile-dbi-2.1.7.tar.gz

tar xvzf guile-dbi-2.1.7.tar.gz
cd guile-dbi-guile-dbi-2.1.7/guile-dbi &amp;&amp; ./configure &amp;&amp; make
sudo make install
</pre></div>

<ul>
<li> guile-dbd <strong>[Optional]</strong>. The dbd plugins connect to an actual database server.
</li></ul>
<div class="example">
<pre class="example">

tar xvzf guile-dbd-mysql-2.1.6.tar.gz
cd guile-dbi-guile-dbi-2.1.7/guile-dbd-mysql &amp;&amp; ./configure &amp;&amp; make
sudo make install
</pre></div>
<p>MySQL is used for the examples in this manual. You may find dbd plugins for other databases <a href="http://download.gna.org/guile-dbi">here</a> or at this
<a href="https://github.com/yagelix/guile-dbi/releases">mirror</a>. The installation process is identical.
</p>
<p><strong>Install the latest GNU Artanis:</strong>
</p>
<div class="example">
<pre class="example">wget -c http://ftp.gnu.org/gnu/artanis/artanis-latest.tar.bz2
tar xvjf artanis-latest.tar.bz2
cd artanis-latest &amp;&amp; ./configure &amp;&amp; make
sudo make install
</pre></div>

<hr>
<span id="For-contributors"></span><div class="header">
<p>
Previous: <a href="#For-users" accesskey="p" rel="prev">For users</a>, Up: <a href="#Installation" accesskey="u" rel="up">Installation</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="For-contributors-1"></span><h3 class="section">3.2 For contributors</h3>

<p>First of all, thank you for contributing! You may clone the main git repository, or the mirror on GitLab:
</p>
<div class="example">
<pre class="example">git clone git://git.savannah.gnu.org/artanis.git

# mirror on GitLab
git clone https://gitlab.com/NalaGinrut/artanis.git
</pre></div>

<hr>
<span id="Configuration"></span><div class="header">
<p>
Next: <a href="#Hello-World" accesskey="n" rel="next">Hello World</a>, Previous: <a href="#Installation" accesskey="p" rel="prev">Installation</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Configuration-1"></span><h2 class="chapter">4 Configuration</h2>

<p>A configuration file is required when Artanis is run for the first time.
</p>
<ul>
<li> If you&rsquo;re using minimum mode, say, all code are in a script file without application directory.
The configure file must be named <code>/etc/artanis/artanis.conf</code>.

</li><li> If you&rsquo;re using application directory, the configure file <code>conf/artanis.conf</code> will be generated automatically for you.
</li></ul>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Config-APIs" accesskey="1">Config APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Config-APIs"></span><div class="header">
<p>
Up: <a href="#Configuration" accesskey="u" rel="up">Configuration</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Config-APIs-1"></span><h3 class="section">4.1 Config APIs</h3>

<p>To change the default configurations:
</p><div class="example">
<pre class="example">(conf-set! key value)
;;e.g
(conf-set! 'debug-mode #t)
</pre></div>

<p>To get the current configuration:
</p><div class="example">
<pre class="example">(get-conf key)
;;e.g
(get-conf '(server charset))
</pre></div>

<p>To get the current hostname in GNU Artanis environment.
</p><div class="example">
<pre class="example">(current-myhost)
</pre></div>

<hr>
<span id="Hello-World"></span><div class="header">
<p>
Next: <a href="#Scheme-Basics" accesskey="n" rel="next">Scheme Basics</a>, Previous: <a href="#Configuration" accesskey="p" rel="prev">Configuration</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Hello-World-1"></span><h2 class="chapter">5 Hello World</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Use-Guile-REPL-and-verify-GNU-Artanis-installation" accesskey="1">Use Guile REPL and verify GNU Artanis installation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Simple-HTTP-server" accesskey="2">Simple HTTP server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Try-simple-URL-remapping" accesskey="3">Try simple URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#More-complex-URL-remapping" accesskey="4">More complex URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Regex-in-URL-remapping" accesskey="5">Regex in URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Database-operating" accesskey="6">Database operating</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Use-Guile-REPL-and-verify-GNU-Artanis-installation"></span><div class="header">
<p>
Next: <a href="#Simple-HTTP-server" accesskey="n" rel="next">Simple HTTP server</a>, Up: <a href="#Hello-World" accesskey="u" rel="up">Hello World</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Use-Guile-REPL-and-verify-GNU-Artanis-installation-1"></span><h3 class="section">5.1 Use Guile REPL and verify GNU Artanis installation</h3>

<p>If you are already familiar with Guile, you may skip this section.
</p>
<p>Type &lsquo;guile&rsquo; in your console to enter the Guile REPL. You should see the following text displayed on your screen:
</p><div class="example">
<pre class="example">GNU Guile 2.2.2
Copyright (C) 1995-2017 Free Software Foundation, Inc.

Guile comes with ABSOLUTELY NO WARRANTY; for details type `,show w'.
This program is free software, and you are welcome to redistribute it
under certain conditions; type `,show c' for details.

Enter `,help' for help.
scheme@(guile-user)&gt;
</pre></div>

<p>Welcome to Guile world! We are now going to play with GNU Artanis. Before we start, we need to check that GNU Artanis is installed correctly:
</p>
<p><strong>(Just type them, you don&rsquo;t have to understand them at present)</strong>
</p>
<div class="example">
<pre class="example">,use (artanis artanis)
artanis-version
</pre></div>

<p>The expected output should be similar to this:
</p><div class="example">
<pre class="example">$1 = &quot;GNU Artanis-x.x.x&quot;
</pre></div>

<hr>
<span id="Simple-HTTP-server"></span><div class="header">
<p>
Next: <a href="#Try-simple-URL-remapping" accesskey="n" rel="next">Try simple URL remapping</a>, Previous: <a href="#Use-Guile-REPL-and-verify-GNU-Artanis-installation" accesskey="p" rel="prev">Use Guile REPL and verify GNU Artanis installation</a>, Up: <a href="#Hello-World" accesskey="u" rel="up">Hello World</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Simple-HTTP-server-1"></span><h3 class="section">5.2 Simple HTTP server</h3>

<p>Run this code in your console:
</p><div class="example">
<pre class="example">guile -c &quot;(use-modules (artanis artanis))(init-server)(run)&quot;
## You'll see this screen:
Anytime you want to quit just try Ctrl+C, thanks!
http://127.0.0.1:3000
</pre></div>

<p>Assuming there&rsquo;s a file named &quot;index.html&quot; in the current path. Now you may try <a href="http://localhost:3000/index.html">http://localhost:3000/index.html</a> in your browser.
It&rsquo;s just simply fetching static file by the URL: <a href="http://localhost:3000/path/filename">http://localhost:3000/path/filename</a>
</p>
<hr>
<span id="Try-simple-URL-remapping"></span><div class="header">
<p>
Next: <a href="#More-complex-URL-remapping" accesskey="n" rel="next">More complex URL remapping</a>, Previous: <a href="#Simple-HTTP-server" accesskey="p" rel="prev">Simple HTTP server</a>, Up: <a href="#Hello-World" accesskey="u" rel="up">Hello World</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Try-simple-URL-remapping-1"></span><h3 class="section">5.3 Try simple URL remapping</h3>

<p>Type these code in Guile REPL:
</p><div class="example">
<pre class="example">(use-modules (artanis artanis))
(init-server)
(get &quot;/hello&quot; (lambda () &quot;hello world&quot;))
(run #:port 8080)
</pre></div>

<p>Now you can visit <a href="http://localhost:8080/hello">http://localhost:8080/hello</a> with your browser, and (hopefully) see the result.
</p>
<p><em>If you encounter &quot;[EXCEPTION] /favicon.ico is abnormal request&quot; , please just ignore that warning.</em>
</p>
<p>Let me explain the code:
</p>
<ul>
<li> <em>line 1:</em> Load GNU Artanis module, (artanis artanis) is the name.
</li></ul>


<ul>
<li> <em>line 2:</em> The first argument <em>get</em> is GNU Artanis&rsquo; API correspondence to the GET method of the HTTP protocol.
The second argument &quot;/hello&quot; is the URL rule to register showing in the address line of e.g. firefox.
The third argument is the handler which will be triggered if the registered URL rule is hit.

</li><li> <em>line 3:</em> Run the GNU Artanis web server, and listen on socket port 8080.
</li></ul>

<p>You may type Ctrl+C to quit and stop the server, see also the message printed on the screen accordingly.
</p>
<hr>
<span id="More-complex-URL-remapping"></span><div class="header">
<p>
Next: <a href="#Regex-in-URL-remapping" accesskey="n" rel="next">Regex in URL remapping</a>, Previous: <a href="#Try-simple-URL-remapping" accesskey="p" rel="prev">Try simple URL remapping</a>, Up: <a href="#Hello-World" accesskey="u" rel="up">Hello World</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="More-complex-URL-remapping-1"></span><h3 class="section">5.4 More complex URL remapping</h3>

<p>Try this code:
</p><div class="example">
<pre class="example">(use-modules (artanis artanis))
(init-server)
(get &quot;/hello/:who&quot;
  (lambda (rc)
    (format #f &quot;&lt;p&gt;hello ~a&lt;/p&gt; &quot; (params rc &quot;who&quot;))))
(run #:port 8080)
</pre></div>

<p>Now you can try <a href="http://localhost:8080/hello/artanis">http://localhost:8080/hello/artanis</a> in your browser.
</p>
<p>There are two differences compared to the simpler example:
</p><ul>
<li> 1. The special rule, &quot;&lsquo;<samp>/hello/:who</samp>&rsquo;&quot;, <em>:who</em> means you can use <em>params</em> to refer to the value of the par of the URL with the key &quot;who&quot;. Like: <code>(params rc &quot;who&quot;)</code>.

</li><li> 2. You may have noticed that the handler is being defined as an anonymous function with <em>lambda</em> has one argument <em>rc</em>. It means <em>route context</em> which preserves all the related context information. Many GNU Artanis APIs need it, e.g.  <em>params</em>.
</li></ul>

<p>And <em>format</em> is a Scheme lib function. It is similar to <em>sprintf</em> in the C language, which outputs text with a formatted pattern.
The second argument #f (means FALSE) indicates that the formatted output should be returned in a string rather than printed out.
</p>
<hr>
<span id="Regex-in-URL-remapping"></span><div class="header">
<p>
Next: <a href="#Database-operating" accesskey="n" rel="next">Database operating</a>, Previous: <a href="#More-complex-URL-remapping" accesskey="p" rel="prev">More complex URL remapping</a>, Up: <a href="#Hello-World" accesskey="u" rel="up">Hello World</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Regex-in-URL-remapping-1"></span><h3 class="section">5.5 Regex in URL remapping</h3>

<p>You can use regular expressions as a URL rule argument.
</p><div class="example">
<pre class="example">(use-modules (artanis artanis))
(init-server)
(get &quot;/.+\\.(png|gif|jpeg)&quot; static-page-emitter)
(run #:port 8080)
</pre></div>

<p><em>static-page-emitter</em> is a GNU Artanis API that sends a static file (images, data files) to the client.
</p>
<hr>
<span id="Database-operating"></span><div class="header">
<p>
Previous: <a href="#Regex-in-URL-remapping" accesskey="p" rel="prev">Regex in URL remapping</a>, Up: <a href="#Hello-World" accesskey="u" rel="up">Hello World</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Database-operating-1"></span><h3 class="section">5.6 Database operating</h3>

<p>GNU Artanis supports mysql/postgresql/sqlite3. We use mysql as an example here.
</p>
<p>Please ensure that your DB service was started before you run this code.
</p>
<p><strong><em>If you encounter any problems, it&rsquo;s very likely it&rsquo;s with your DB config.</em></strong>
</p>
<p>You can use a DB (such as mysql) with GUI tools such as &quot;adminer&quot;, independently of the running web-server, e.g. artanis-based.
</p><div class="example">
<pre class="example">(use-modules (artanis artanis))
(init-server)
(define conn (connect-db 'mysql #:db-username &quot;your_db_username&quot;
                         #:db-name &quot;your_db_name&quot; #:db-passwd &quot;your_passwd&quot;))
(define mtable (map-table-from-DB conn))
((mtable 'create 'Persons '((name varchar 10)
                            (age integer)
                            (email varchar 20)))
 'valid?)
;; ==&gt; #t
(mtable 'set 'Persons #:name &quot;nala&quot; #:age 99 #:email &quot;nala@artanis.com&quot;)
(mtable 'get 'Persons #:columns '(name email))
;; ==&gt; (((&quot;name&quot; . &quot;nala&quot;) (&quot;email&quot; . &quot;nala@artanis.com&quot;)))
</pre></div>

<ul>
<li> <em>map-table-from-DB</em> is the GNU Artanis API handling tables in a DB. Here, we define this mapping as the var <em>mtable</em>.
</li></ul>


<ul>
<li> We can use <em>mtable</em> to handle tables, you can get the values from a table with the &rsquo;get command.
</li></ul>


<ul>
<li> <em>mtable</em> is a function which accepts the first argument as a command, say &rsquo;create, which is a command to create a new table. &rsquo;set is used to insert/update values in the table. And the &rsquo;get command to fetch the values of specific columns.
</li></ul>


<ul>
<li> The second argument of <em>mtable</em> is the name of the table as you can guess. Please note that it is case sensitive, while the column name isn&rsquo;t.
</li></ul>


<ul>
<li> The <em><strong>&rsquo;create</strong></em> command returns a function too, which also accepts an argument as a command. Here, we use the <em><strong>&rsquo;valid?</strong></em> command to check if the table has been created successfully.
</li></ul>

<p>This was just a simple introduction. You may read the DB section in this manual for details.
</p>
<p>Of course, you can use DB in your web application.
</p><div class="example">
<pre class="example">(get &quot;/dbtest&quot; #:conn #t ; apply for a DB connection from pool
     (lambda (rc)
       (let ((mtable (map-table-from-DB (:conn rc))))
         (object-&gt;string
          (mtable 'get 'Persons #:columns '(name email))))))

(run #:use-db? #t #:dbd 'mysql #:db-username &quot;your_db_username&quot;
     #:db-name &quot;your_db_name&quot; #:db-passwd &quot;your_passwd&quot; #:port 8080)
</pre></div>

<p>Now, try loading <a href="http://localhost:8080/dbtest">http://localhost:8080/dbtest</a> in your browser.
</p>
<p>Here is quick explanation:
</p><ul>
<li> The keyword-value pair <code>#:conn #t</code> means applying for a DB connection from connection-pool.
Then you can use <code>(:conn rc)</code> to get the allocated connection for DB operations.

</li><li> Finally, the handler needs to return a string as the HTTP response body, so in this example, we have to use the Guile
API <em>object-&gt;string</em> to convert the query result into a string.
</li></ul>

<p><em>Exercise: Return a beautiful table in HTML rather than using object-&gt;string.</em>
</p>
<hr>
<span id="Scheme-Basics"></span><div class="header">
<p>
Next: <a href="#GNU-Artanis-Basics" accesskey="n" rel="next">GNU Artanis Basics</a>, Previous: <a href="#Hello-World" accesskey="p" rel="prev">Hello World</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Scheme-Basics-1"></span><h2 class="chapter">6 Scheme Basics</h2>

<p>This chapter introduces some useful documents to help you understand Scheme language.
Feel free to come back here if you have any problems with the Scheme syntax.
</p>
<p>Scheme was introduced in 1975 by Gerald J. Sussman and Guy L. Steele Jr. and was the first dialect of Lisp to fully support lexical scoping,
first-class procedures, and continuations. In its earliest form it was a small language intended primarily for research and teaching,
supporting only a handful of predefined syntactic forms and procedures. Scheme is now a complete general-purpose programming language, though
it still derives its power from a small set of key concepts. Early implementations of the language were interpreter-based and slow, but
Guile Scheme is trying to implement sophisticated compiler that generate better optimized code, and even a plan for AOT compiler generated
native code in the future.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#For-newbies" accesskey="1">For newbies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-Pythonistas" accesskey="2">For Pythonistas</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-Rubyist" accesskey="3">For Rubyist</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#For-deep-learners" accesskey="4">For deep learners</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="For-newbies"></span><div class="header">
<p>
Next: <a href="#For-Pythonistas" accesskey="n" rel="next">For Pythonistas</a>, Up: <a href="#Scheme-Basics" accesskey="u" rel="up">Scheme Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="For-newbies-1"></span><h3 class="section">6.1 For newbies</h3>

<p>If you&rsquo;re not familiar with Scheme and Guile in particular, here is a simple tutorial for you.
</p>
<p>If you already know the basics of the Scheme language, please feel free to skip this section.
</p>
<p>I would recommend newbies to type/paste the code in Guile REPL following the guide in tutorial:
<a href="http://web-artanis.com/scheme.html">Learn Scheme in 15 minutes</a>
</p>
<p>And here&rsquo;s a nice section in the Guile manual for basics in Scheme:
<a href="https://www.gnu.org/software/guile/manual/guile.html#Hello-Scheme_0021">Hello Scheme</a>
</p>
<p>Please don&rsquo;t spend too much time on these tutorials, the purpose is to let newbies get a little familiar with the grammar of Scheme.
</p>
<hr>
<span id="For-Pythonistas"></span><div class="header">
<p>
Next: <a href="#For-Rubyist" accesskey="n" rel="next">For Rubyist</a>, Previous: <a href="#For-newbies" accesskey="p" rel="prev">For newbies</a>, Up: <a href="#Scheme-Basics" accesskey="u" rel="up">Scheme Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="For-Pythonistas-1"></span><h3 class="section">6.2 For Pythonistas</h3>

<p>These are good pythonic articles for Pythoners:
</p>
<ol>
<li> <a href="http://draketo.de/proj/guile-basics/">Guile basics from the perspective of a Pythonista</a>
</li><li> <a href="http://draketo.de/proj/py2guile">Going from Python to Guile Scheme</a>
</li></ol>

<p>Still, please don&rsquo;t spend too much time on them, the purpose is to let newbies get a little familiar with the grammar of Scheme.
</p>
<hr>
<span id="For-Rubyist"></span><div class="header">
<p>
Next: <a href="#For-deep-learners" accesskey="n" rel="next">For deep learners</a>, Previous: <a href="#For-Pythonistas" accesskey="p" rel="prev">For Pythonistas</a>, Up: <a href="#Scheme-Basics" accesskey="u" rel="up">Scheme Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="For-Rubyist-1"></span><h3 class="section">6.3 For Rubyist</h3>

<p>Here&rsquo;s a great article for Rubyist to learn Scheme:
</p><ol>
<li> <a href="http://wiki.call-cc.org/chicken-for-ruby-programmers">Scheme for ruby programmers</a>
</li></ol>

<hr>
<span id="For-deep-learners"></span><div class="header">
<p>
Previous: <a href="#For-Rubyist" accesskey="p" rel="prev">For Rubyist</a>, Up: <a href="#Scheme-Basics" accesskey="u" rel="up">Scheme Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="For-deep-learners-1"></span><h3 class="section">6.4 For deep learners</h3>

<p>These two books are very good for learning Scheme seriously:
</p>
<ol>
<li> <a href="http://www.scheme.com/tspl4/">The Scheme Programming Language</a>
</li><li> <a href="http://mitpress.mit.edu/sicp/">Structure and Interpretation of Computer Programs(SICP)</a>
</li></ol>

<p>Please don&rsquo;t bother reading them if you simply want to use GNU Artanis to build your web application/site in few minutes.
</p>
<p>And if you really want to try to work these books seriously, please ignore GNU Artanis before you are done with them.
</p>
<p>But once you&rsquo;re done reading them <strong>carefully</strong>, you may want to write a new GNU Artanis all by yourself!
</p>
<p>Hold your horses. ;-)
</p>
<hr>
<span id="GNU-Artanis-Basics"></span><div class="header">
<p>
Next: <a href="#The-Art-command-line" accesskey="n" rel="next">The Art command line</a>, Previous: <a href="#Scheme-Basics" accesskey="p" rel="prev">Scheme Basics</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="GNU-Artanis-Basics-1"></span><h2 class="chapter">7 GNU Artanis Basics</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#How-to-run-a-site-with-GNU-Artanis" accesskey="1">How to run a site with GNU Artanis</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Initialization" accesskey="2">Initialization</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Registering-handlers-for-HTTP-methods" accesskey="3">Registering handlers for HTTP methods</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Emit-a-Response" accesskey="4">Emit a Response</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Running-the-server" accesskey="5">Running the server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Working-with-Nginx" accesskey="6">Working with Nginx</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="How-to-run-a-site-with-GNU-Artanis"></span><div class="header">
<p>
Next: <a href="#Initialization" accesskey="n" rel="next">Initialization</a>, Up: <a href="#GNU-Artanis-Basics" accesskey="u" rel="up">GNU Artanis Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="How-to-run-a-site-with-GNU-Artanis-1"></span><h3 class="section">7.1 How to run a site with GNU Artanis</h3>

<p>This is the simplest way to run a site:
</p><div class="example">
<pre class="example">#!/bin/env guile
!#
(use-modules (artanis artanis))
(init-server)
(get &quot;/hello&quot; (lambda () &quot;hello world&quot;))
(run)
</pre></div>

<hr>
<span id="Initialization"></span><div class="header">
<p>
Next: <a href="#Registering-handlers-for-HTTP-methods" accesskey="n" rel="next">Registering handlers for HTTP methods</a>, Previous: <a href="#How-to-run-a-site-with-GNU-Artanis" accesskey="p" rel="prev">How to run a site with GNU Artanis</a>, Up: <a href="#GNU-Artanis-Basics" accesskey="u" rel="up">GNU Artanis Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Initialization-1"></span><h3 class="section">7.2 Initialization</h3>

<p>It&rsquo;s better to use (init-server) to init GNU Artanis.
</p><div class="example">
<pre class="example">(init-server #:statics '(png jpg jpeg ico html js css)
             #:cache-statics? #f #:exclude '())
</pre></div>

<p><code>#:statics</code> specifies the static files with the file name extensions. GNU Artanis is based on URL remapping, so the requested URL will have to end in the requested file name, matching the string defined, and returning the file without any extra defintions per file type. By default, it covers the most common static file types.
</p>
<p><code>#:cache-statics?</code> controls whether the static files should be cached.
</p>
<p><code>#:exclude</code> specifies the types should be excluded. This is useful when you want to generate files dynamically. Even JavaScript/CSS could be generated dynamically, so it depends your design.
</p>
<hr>
<span id="Registering-handlers-for-HTTP-methods"></span><div class="header">
<p>
Next: <a href="#Emit-a-Response" accesskey="n" rel="next">Emit a Response</a>, Previous: <a href="#Initialization" accesskey="p" rel="prev">Initialization</a>, Up: <a href="#GNU-Artanis-Basics" accesskey="u" rel="up">GNU Artanis Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Registering-handlers-for-HTTP-methods-1"></span><h3 class="section">7.3 Registering handlers for HTTP methods</h3>

<p>Please read <a href="#URL-handling">URL handling</a>.
</p>
<hr>
<span id="Emit-a-Response"></span><div class="header">
<p>
Next: <a href="#Running-the-server" accesskey="n" rel="next">Running the server</a>, Previous: <a href="#Registering-handlers-for-HTTP-methods" accesskey="p" rel="prev">Registering handlers for HTTP methods</a>, Up: <a href="#GNU-Artanis-Basics" accesskey="u" rel="up">GNU Artanis Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Emit-a-Response-1"></span><h3 class="section">7.4 Emit a Response</h3>

<div class="example">
<pre class="example">(response-emit body #:status 200 #:headers '() #:mtime (current-time))
</pre></div>

<p><strong>body</strong> is the response body, it can be a bytevector or literal string (in HTML).
</p>
<p><code>#:status</code> is the HTTP status, 200 in default, which means OK.
</p>
<p><code>#:headers</code> lets you specify custom HTTP headers. The headers must follow a certain format. Please read <a href="http://www.gnu.org/software/guile/manual/html_node/HTTP-Headers.html#Response-Headers">Response Headers</a> for details.
</p>
<p><code>#:mtime</code> specifies the modified time in the response. GNU Artanis will generate it for you when not defined.
</p>
<div class="example">
<pre class="example">(emit-response-with-file filename [headers &lt;- '()])
</pre></div>

<p><strong>filename</strong> is the filename to be sent as a response.
</p>
<p>[headers] is the custom HTTP headers.
</p>
<hr>
<span id="Running-the-server"></span><div class="header">
<p>
Next: <a href="#Working-with-Nginx" accesskey="n" rel="next">Working with Nginx</a>, Previous: <a href="#Emit-a-Response" accesskey="p" rel="prev">Emit a Response</a>, Up: <a href="#GNU-Artanis-Basics" accesskey="u" rel="up">GNU Artanis Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Running-the-server-1"></span><h3 class="section">7.5 Running the server</h3>

<div class="example">
<pre class="example">(run #:host #f #:port #f #:debug #f #:use-db? #f
     #:dbd #f #:db-username #f #:db-passwd #f #:db-name #f)
</pre></div>

<p><em>keywords with the value #f, as default, will get the values from the config file.</em>
</p>
<p>But you can define them as well.
</p>
<p><code>#:host</code> the hostname.
</p>
<p><code>#:port</code> the socket port of the server.
</p>
<p><code>#:debug</code> set #t if you want to enable debug mode. Logs will be more verbose.
</p>
<p><code>#:use-db?</code> set #t if you want to use DB, and GNU Artanis will initialize DB connections.
</p>
<p><code>#:dbd</code> choose a dbd. These are the supported three: mysql, postgresql, and sqlite3.
</p>
<p><code>#:db-username</code> the username of your DB server.
</p>
<p><code>#:db-passwd</code> the DB password for the user above.
</p>
<p><code>#:db-name</code> the DB name to use.
</p>
<hr>
<span id="Working-with-Nginx"></span><div class="header">
<p>
Previous: <a href="#Running-the-server" accesskey="p" rel="prev">Running the server</a>, Up: <a href="#GNU-Artanis-Basics" accesskey="u" rel="up">GNU Artanis Basics</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Working-with-Nginx-1"></span><h3 class="section">7.6 Working with Nginx</h3>

<p>You may try GNU Artanis+Nginx with a reverse proxy.
</p>
<p><strong><em>Although GNU Artanis has good server core, I would recommend you use Nginx as the front server. In addition to the enhanced
performance, it&rsquo;ll also be less vulnerable to attacks.</em></strong>
</p>
<p>These are some sample lines for /etc/nginx/nginx.conf:
</p>
<div class="example">
<pre class="example">location / {
proxy_pass http://127.0.0.1:1234;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
</pre></div>
<p>To make it work, restart Nginx after editing the file:
</p>
<div class="example">
<pre class="example">sudo service nginx restart
</pre></div>

<p>And run GNU Artanis:
</p><div class="example">
<pre class="example">(run #:port 1234)
</pre></div>

<hr>
<span id="The-Art-command-line"></span><div class="header">
<p>
Next: <a href="#URL-remapping" accesskey="n" rel="next">URL remapping</a>, Previous: <a href="#GNU-Artanis-Basics" accesskey="p" rel="prev">GNU Artanis Basics</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="The-Art-command-line-1"></span><h2 class="chapter">8 The Art command line</h2>

<p>GNU Artanis provides the <strong>art</strong> command line tool to save users&rsquo; time.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#art-create" accesskey="1">art create</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-draw" accesskey="2">art draw</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-api" accesskey="3">art api</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-migrate" accesskey="4">art migrate</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#art-work" accesskey="5">art work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="art-create"></span><div class="header">
<p>
Next: <a href="#art-draw" accesskey="n" rel="next">art draw</a>, Up: <a href="#The-Art-command-line" accesskey="u" rel="up">The Art command line</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="art-create-1"></span><h3 class="section">8.1 art create</h3>

<p>If you want to set up your site/app in an application directory, and take advantage
of the MVC features, you have to use this command to create the application directory
first.
</p>
<div class="example">
<pre class="example">art create proj_path
</pre></div>

<hr>
<span id="art-draw"></span><div class="header">
<p>
Next: <a href="#art-api" accesskey="n" rel="next">art api</a>, Previous: <a href="#art-create" accesskey="p" rel="prev">art create</a>, Up: <a href="#The-Art-command-line" accesskey="u" rel="up">The Art command line</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="art-draw-1"></span><h3 class="section">8.2 art draw</h3>

<p>This command will generate the specified components:
</p><div class="example">
<pre class="example">Usage:
  art draw &lt;component&gt; NAME [options]

component list:
  model
  controller
  migration

Options:
  -h, [--help]     # Print this screen
  -d, [--dry]      # Dry run but do not make any changes
  -f, [--force]    # Overwrite files that already exist
  -s, [--skip]     # Skip files that already exist
                   # If -s and -f are both provided, -f will be enabled
  -q, [--quiet]    # Suppress status output

Example:
  art draw model myblog
</pre></div>

<p>Please see <a href="#MVC">MVC</a> to learn more about how to use these components.
</p>
<hr>
<span id="art-api"></span><div class="header">
<p>
Next: <a href="#art-migrate" accesskey="n" rel="next">art migrate</a>, Previous: <a href="#art-draw" accesskey="p" rel="prev">art draw</a>, Up: <a href="#The-Art-command-line" accesskey="u" rel="up">The Art command line</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="art-api-1"></span><h3 class="section">8.3 art api</h3>

<p>This command is used to generate RESTful API skeleton.
</p><div class="example">
<pre class="example">Usage:
  art api [options]

Options:
  -h, [--help]     # Print this screen
  -d, [--dry]      # Dry run but do not make any changes
  -f, [--force]    # Overwrite files that already exist
  -s, [--skip]     # Skip files that already exist
                   # If -s and -f are both provided, -f will be enabled
  -q, [--quiet]    # Suppress status output
  -l, [--list]     # List all defined APIs
  -m, [--mode]     # Specify the WebAPI mode, the default is &quot;restful&quot;
  -v, [--ver]      # Specify the WebAPI version, omit it to auto detect
  -c, [--create]   # Create WebAPI

Example:
  art api -c  
  art api -c -v v3
</pre></div>
<p>Please see <a href="#RESTful-API">RESTful API</a> for more details.
</p>
<hr>
<span id="art-migrate"></span><div class="header">
<p>
Next: <a href="#art-work" accesskey="n" rel="next">art work</a>, Previous: <a href="#art-api" accesskey="p" rel="prev">art api</a>, Up: <a href="#The-Art-command-line" accesskey="u" rel="up">The Art command line</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="art-migrate-1"></span><h3 class="section">8.4 art migrate</h3>

<p>Migrate is used for Database migration.
</p><div class="example">
<pre class="example">Usage:
  art migrate operator name [OPTIONS]

Operators:
  up
  down

OPTIONS:
  VERSION=version
</pre></div>
<p>Please see <a href="#Migration">Migration</a> for more detail.
</p>
<hr>
<span id="art-work"></span><div class="header">
<p>
Previous: <a href="#art-migrate" accesskey="p" rel="prev">art migrate</a>, Up: <a href="#The-Art-command-line" accesskey="u" rel="up">The Art command line</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="art-work-1"></span><h3 class="section">8.5 art work</h3>

<p>This command is used to start the server when run in a project directory:
</p><div class="example">
<pre class="example">Usage:
  art work [options]

Options:
  -c, [--config=CONFIG]          # Specify config file
                                   Default: conf/artanis.conf
                                            if no, /etc/artanis/artanis.conf
  -h, [--host=HOST]              # Specify the network host
                                   Default: 0.0.0.0
  -d, [--usedb]                  # Whether to use Database
                                   Default: false
  -b, [--dbd=DBD]                # Specify DBD, mysql/postgresql/sqlit3
                                   Default: mysql
  -n, [--name=DATABASE_NAME]     # Database name
                                   Default: artanis
  -w, [--passwd=PASSWD]          # Database password
                                   Default: none
  -u, [--user=USER]              # Database user name
                                   Default: root
  -p, [--port=PORT]              # Specify listening port
                                   Default: 3000
  -g, [--debug]                  # Debug mode
                                   Default: disable
  -s, [--server=SERVER]          # Specify server core
                                   Default: Ragnarok (New server core since 0.2)
  --refresh                      # Clean caches, and force to re-compile all source code.                                                         
  --help                         # Show this screen
</pre></div>

<ul>
<li> For server core alternatives, please see <code>server.config</code> in config.
</li><li> For Database (DBD) alternatives, please see <code>database.config</code> in config.
</li></ul>

<p><strong>NOTE:</strong> Please make sure use <code>art work --refresh</code> to recompile WebApp code each time you upgrade GNU Artanis.
And if you want to clean the caches for debug, <code>--refresh</code> is also your friend.
</p>
<hr>
<span id="URL-remapping"></span><div class="header">
<p>
Next: <a href="#Route-context" accesskey="n" rel="next">Route context</a>, Previous: <a href="#The-Art-command-line" accesskey="p" rel="prev">The Art command line</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="URL-remapping-1"></span><h2 class="chapter">9 URL remapping</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Introduction-to-URL-remapping" accesskey="1">Introduction to URL remapping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#URL-handling" accesskey="2">URL handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#OPTIONS-method" accesskey="3">OPTIONS method</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Get-parameters-from-a-URL" accesskey="4">Get parameters from a URL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Redirecting" accesskey="5">Redirecting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Introduction-to-URL-remapping"></span><div class="header">
<p>
Next: <a href="#URL-handling" accesskey="n" rel="next">URL handling</a>, Up: <a href="#URL-remapping" accesskey="u" rel="up">URL remapping</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Introduction-to-URL-remapping-1"></span><h3 class="section">9.1 Introduction to URL remapping</h3>

<p>URL remapping is used to modify a web URL&rsquo;s appearance to provide short, pretty or fancy, search engine friendly URLs.
It&rsquo;s largely used in modern WAFs(web application framework) to provide RESTful web APIs.
</p>
<hr>
<span id="URL-handling"></span><div class="header">
<p>
Next: <a href="#OPTIONS-method" accesskey="n" rel="next">OPTIONS method</a>, Previous: <a href="#Introduction-to-URL-remapping" accesskey="p" rel="prev">Introduction to URL remapping</a>, Up: <a href="#URL-remapping" accesskey="u" rel="up">URL remapping</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="URL-handling-1"></span><h3 class="section">9.2 URL handling</h3>

<p>According to RFC2616, the methods include GET, POST, etc. However, because of the naming conflict, GNU Artanis provides
the methods by this list:
</p><ul>
<li> get
</li><li> post
</li><li> put
</li><li> patch
</li><li> page-delete
</li><li> page-options
</li></ul>

<p><em>In GNU Artanis the HEAD method is handled by the server, so you can&rsquo;t define specific handlers directly for it within GNU Artanis.</em>
</p>
<p>Usage:
</p><div class="example">
<pre class="example">(method rule handler)
</pre></div>

<p>And the handler could be one of two types, depending on your needs:
</p><div class="example">
<pre class="example">(lambda ()
  ...
  ret)

(lambda (rc)
  ...
  ret)
</pre></div>

<p><strong>ret</strong> also has two types:
</p>
<ul>
<li> 1. literal string as the returned response body

</li><li> 2. See <a href="#Emit-a-Response">Emit a Response</a>
</li></ul>

<div class="example">
<pre class="example">(get &quot;/hello&quot; (lambda () &quot;hello world&quot;))
</pre></div>

<p>For a POST method:
</p><div class="example">
<pre class="example">(post &quot;/auth&quot; (lambda (rc) ...))
</pre></div>

<hr>
<span id="OPTIONS-method"></span><div class="header">
<p>
Next: <a href="#Get-parameters-from-a-URL" accesskey="n" rel="next">Get parameters from a URL</a>, Previous: <a href="#URL-handling" accesskey="p" rel="prev">URL handling</a>, Up: <a href="#URL-remapping" accesskey="u" rel="up">URL remapping</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="OPTIONS-method-1"></span><h3 class="section">9.3 OPTIONS method</h3>

<p>OPTIONS method is used to return the other methods supported by the server-side at the given URL.
By default in GNU Artanis, for a specified URL, every method whose handler was registerted would be added to its own OPTIONS list.
</p>
<p>If you want to deny certain methods for security consideration, you may need to set <strong>server.allowedmethods</strong> in config.
</p>
<p><strong>NOTE:</strong> If you&rsquo;re not trying to use Cross-Origin Resource Sharing (CORS), then you may not need to care about it.
</p>
<hr>
<span id="Get-parameters-from-a-URL"></span><div class="header">
<p>
Next: <a href="#Redirecting" accesskey="n" rel="next">Redirecting</a>, Previous: <a href="#OPTIONS-method" accesskey="p" rel="prev">OPTIONS method</a>, Up: <a href="#URL-remapping" accesskey="u" rel="up">URL remapping</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Get-parameters-from-a-URL-1"></span><h3 class="section">9.4 Get parameters from a URL</h3>

<div class="example">
<pre class="example">(params rc name)
;; e.g
(get &quot;/hello/:who&quot; (lambda (rc) (params rc &quot;who&quot;)))
</pre></div>

<hr>
<span id="Redirecting"></span><div class="header">
<p>
Previous: <a href="#Get-parameters-from-a-URL" accesskey="p" rel="prev">Get parameters from a URL</a>, Up: <a href="#URL-remapping" accesskey="u" rel="up">URL remapping</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Redirecting-1"></span><h3 class="section">9.5 Redirecting</h3>

<div class="example">
<pre class="example">(redirect-to rc path #:status 301 #:type '(text/html) #:headers '())
;; e.g
(get &quot;/aaa&quot; (lambda (rc) (redirect-to rc &quot;/bbb&quot;)))
(get &quot;/bbb&quot; (lambda () &quot;ok bbb&quot;))
</pre></div>

<p>The <strong>path</strong> could be 2 possible patterns:
</p><ul>
<li> URI created by <a href="https://www.gnu.org/software/guile/manual/html_node/URIs.html">string-&gt;uri</a>. For example, <code>(redirect-to rc (string-&gt;uri &quot;https://nalaginrut.com/feed/atom&quot;))</code>.
</li><li> A relative path which will finally be converted to absolute URL append the <strong>host.addr</strong>.
For example, <code>(redirect-to rc &quot;/login&quot;)</code>.
</li></ul>

<p><strong>NOTE:</strong> redirect-to will always use absolute URL implicitly. Although the standard supports relative URL,
there maybe some problems when you&rsquo;re behind a proxy. So we use absolute URL to avoid these issues.
</p>
<hr>
<span id="Route-context"></span><div class="header">
<p>
Next: <a href="#Page-status-handling" accesskey="n" rel="next">Page status handling</a>, Previous: <a href="#URL-remapping" accesskey="p" rel="prev">URL remapping</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Route-context-1"></span><h2 class="chapter">10 Route context</h2>

<p>Route context is a struct type object which encapsulates the necessary information for the server from the current request context.
We named it <em>route</em> because it&rsquo;s related to the route of <a href="#URL-remapping">URL remapping</a>.
Usually it&rsquo;s passed to the page handler as a unique argument. It&rsquo;s supposed to provide sufficient data about the current request.
</p>
<div class="example">
<pre class="example">(HTTP-METHOD URL-rule (lambda (&lt;route-context&gt;) ...))
;; e.g:
(get &quot;/hello&quot; (lambda (rc) &quot;world&quot;)) ; rc is &lt;route-context&gt; type
</pre></div>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Route-context-APIs" accesskey="1">Route context APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Route-context-APIs"></span><div class="header">
<p>
Up: <a href="#Route-context" accesskey="u" rel="up">Route context</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Route-context-APIs-1"></span><h3 class="section">10.1 Route context APIs</h3>

<div class="example">
<pre class="example">(rc-path &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get the requested path, that is to say, the actual URI visited by the client.
</li></ul>

<div class="example">
<pre class="example">;; e.g
(get &quot;/hello/world&quot; (lambda (rc) (rc-path rc)))
;; visit localhost:3000/hello/world or from any port you specified
;; the result is &quot;/hello/world&quot;.
(get &quot;/hello/:who&quot; (lambda (rc) (rc-path rc)))
;; visit localhost:3000/hello/world or from any port you specified
;; the result is &quot;/hello/world&quot;.
</pre></div>

<div class="example">
<pre class="example">(rc-req &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get the current HTTP request wrapped in record-type. About HTTP request
please see <a href="https://www.gnu.org/software/guile/manual/html_node/Requests.html">HTTP Request</a>. It stores HTTP request of Guile.
</li></ul>

<div class="example">
<pre class="example">(rc-body &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get the current request body:
<ul>
<li> For a regular HTTP request, the body should be a bytevector;
</li><li> For a Websocket request, the body should be <a href="#Websocket-frame">Websocket frame</a> as a record-type.
</li></ul>
</li></ul>

<div class="example">
<pre class="example">(rc-method &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get the current requested HTTP method.
</li></ul>

<div class="example">
<pre class="example">(rc-conn &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get the current DB connection if you&rsquo;ve requested one, please checkout [BROKEN LINK: DB shortcut].
</li></ul>

<div class="example">
<pre class="example">(rc-qt &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get query table, which is a key-value list parsed from <a href="#Query-String">query string</a>.
</li></ul>

<div class="example">
<pre class="example">(rc-handler &lt;route-context&gt;)
</pre></div>
<ul>
<li> Get the current request handler. The tricky part is that you can only get this handler
within this handler unless you can go no where to run <em>rc-handler</em> correctly.
<ul>
<li> It&rsquo;s on your own risk to use this API. But now that we have powerful first class lambda,
you may do some magic. Well, depends on you.
</li></ul>
</li></ul>

<div class="example">
<pre class="example">(rc-mtime &lt;route-context&gt;) ; getter
(rc-mtime! &lt;route-context&gt;) ; setter
</pre></div>
<ul>
<li> You may set it in the handler to return you customized modified time.
For static pages, the mtime is set automatically. But sometimes people
may want to set it in a dynamic generated page.
</li></ul>

<div class="example">
<pre class="example">(rc-cookie &lt;route-context&gt;)
</pre></div>
<ul>
<li> The cookies parsed from request header.
</li></ul>

<div class="example">
<pre class="example">(rc-set-cookie! &lt;route-context&gt;)
</pre></div>
<ul>
<li> Set response cookie from server side. If you want to return cookies to
the client, please use it.
</li></ul>

<p>There&rsquo;re other APIs in <em>route-context</em>, but they&rsquo;re largely used for
internals of Artanis, rarely useful for users. So we don&rsquo;t list them here.
</p>
<hr>
<span id="Page-status-handling"></span><div class="header">
<p>
Next: <a href="#MVC" accesskey="n" rel="next">MVC</a>, Previous: <a href="#Route-context" accesskey="p" rel="prev">Route context</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Page-status-handling-1"></span><h2 class="chapter">11 Page status handling</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#HTTP-status-code" accesskey="1">HTTP status code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-default-behaviour-of-status-handling" accesskey="2">The default behaviour of status handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Dynamic-status-page-generating" accesskey="3">Dynamic status page generating</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="HTTP-status-code"></span><div class="header">
<p>
Next: <a href="#The-default-behaviour-of-status-handling" accesskey="n" rel="next">The default behaviour of status handling</a>, Up: <a href="#Page-status-handling" accesskey="u" rel="up">Page status handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="HTTP-status-code-1"></span><h3 class="section">11.1 HTTP status code</h3>

<p>HTTP response status codes are the error numbers show the status of a specific HTTP request. The responses are grouped in five classes:
</p><ul>
<li> Informational responses (100–199)
</li><li> Successful responses (200–299)
</li><li> Redirects (300–399)
</li><li> Client errors (400–499)
</li><li> Server errors (500–599)
</li></ul>

<hr>
<span id="The-default-behaviour-of-status-handling"></span><div class="header">
<p>
Next: <a href="#Dynamic-status-page-generating" accesskey="n" rel="next">Dynamic status page generating</a>, Previous: <a href="#HTTP-status-code" accesskey="p" rel="prev">HTTP status code</a>, Up: <a href="#Page-status-handling" accesskey="u" rel="up">Page status handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="The-default-behaviour-of-status-handling-1"></span><h3 class="section">11.2 The default behaviour of status handling</h3>

<p>On success, GNU Artanis returns the status code 200.
</p>
<p>If there&rsquo;s any issue prevents GNU Artanis to generate requested result successfully, then it&rsquo;ll throw the relavent exception somewhere issue
happened. And finally it will be caught by the server-core. In theory, the status code other than 200 will trigger a system page generating
operation. By default, status pages are put in <strong>/etc/artanis/pages</strong>, but you may override it in <strong>your_app_folder/sys/pages</strong>. Each system page
named with the status code, say, <strong>404.html</strong>. So you may easily customize your preferred status page.
</p>
<hr>
<span id="Dynamic-status-page-generating"></span><div class="header">
<p>
Previous: <a href="#The-default-behaviour-of-status-handling" accesskey="p" rel="prev">The default behaviour of status handling</a>, Up: <a href="#Page-status-handling" accesskey="u" rel="up">Page status handling</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Dynamic-status-page-generating-1"></span><h3 class="section">11.3 Dynamic status page generating</h3>

<p>Sometimes you may need more complex status page generating. For example, you want to put a random public service advertising when the visitors
encountered a 404 (page missing). Then you can do it like this:
</p><div class="example">
<pre class="example">(http-status status-code thunk-handler)
</pre></div>
<ul>
<li> <strong>status-code</strong> must be an integer between 100~599.
</li><li> <strong>Thunk</strong> implies a function without any argument.
</li></ul>
<p>Let&rsquo;s see an example:
</p>
<div class="example">
<pre class="example">;; You may put this code in any controller module.
(http-status 404
 (lambda ()
   (view-render &quot;psd_404&quot; (the-environment))))
</pre></div>

<p>In this example, &quot;psd&quot; stands for public-service-advertising, and &quot;psd_404&quot; tells the <strong>view-render</strong> to find &quot;psd_404.html&quot; in
<strong>your_app_folder/sys/pages/psd_404.html</strong>. So you can render the HTML template to generate a status page. Of course, there&rsquo;re a few ways to
implement the similar idea. If you don&rsquo;t want to render template on the backend, you may generate a JSON and let the frontend framework to
generate it.
</p>
<hr>
<span id="MVC"></span><div class="header">
<p>
Next: <a href="#Query-String" accesskey="n" rel="next">Query String</a>, Previous: <a href="#Page-status-handling" accesskey="p" rel="prev">Page status handling</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="MVC-1"></span><h2 class="chapter">12 MVC</h2>

<p>MVC is Model-View-Controller, the most classic architectural pattern for implementing
user interfaces.
It divides a given software application into three interconnected parts, so as to
separate internal representations of information from the ways that information is
presented to or accepted from the user.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Controllers_002fViews" accesskey="1">Controllers/Views</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Models" accesskey="2">Models</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Controllers_002fViews"></span><div class="header">
<p>
Next: <a href="#Models" accesskey="n" rel="next">Models</a>, Up: <a href="#MVC" accesskey="u" rel="up">MVC</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Controllers_002fViews-1"></span><h3 class="section">12.1 Controllers/Views</h3>

<p>Let&rsquo;s make a controller named <em>article</em>:
</p><div class="example">
<pre class="example">art draw controller article show edit
</pre></div>

<p><em>show</em> and <em>edit</em> are the name of methods for the controller named <em>article</em>.
</p>
<p>This will generate both a <strong>controller</strong> and a <strong>view</strong> for <em>article</em>:
</p><div class="example">
<pre class="example">drawing    controller article
working    Controllers `article.scm'
create     app/controllers/article.scm
working    Views `article'
create     app/views/article/show.html.tpl
create     app/views/article/edit.html.tpl
</pre></div>

<p>These three files are generated:
</p><div class="example">
<pre class="example">app/controllers/article.scm
app/views/article/show.html.tpl
app/views/article/edit.html.tpl
</pre></div>

<p>Based on this, the controller <em>article</em> will have two methods mapped to the URL rule, <em>show</em> and <em>edit</em>.
As part of the <em>view</em> component. An HTML template is generated for each method. For the <em>show</em> method for example, the view file <strong>show.html.tpl</strong> is created.
For the <em>controller</em> component, you get a <em>show</em> method handler, as:
</p><div class="example">
<pre class="example">(article-define show
                (lambda (rc)
                  &quot;&lt;h1&gt;This is article#show&lt;/h1&gt;&lt;p&gt;Find me in app/views/article/show.html.tpl&lt;/p&gt;&quot;
                  ;; TODO: add controller method `show'
                  ;; uncomment this line if you want to render view from template
                  ;; (view-render &quot;show&quot;)
                  ))
</pre></div>
<p>Of course, you&rsquo;re free to use or not use these templates. If you want to use the <em>view template</em>, just
uncomment the last line <code>(view-render &quot;show&quot;)</code>.
</p>
<p><strong>NOTE:</strong> The views template generated by MVC will defaultly announce FreeJS. The reason was well explained in [BROKEN LINK:  http://www.gnu.org/philosophy/javascript-trap.en.html].
It&rsquo;s optional, you may remove it with your free will, but I put it there in the hope that you can support free software with us.
</p>
<p>For more detail about template in Views, please see <a href="#Layouts-and-Rendering-in-GNU-Artanis">Layouts and Rendering in GNU Artanis</a>.
</p>
<hr>
<span id="Models"></span><div class="header">
<p>
Previous: <a href="#Controllers_002fViews" accesskey="p" rel="prev">Controllers/Views</a>, Up: <a href="#MVC" accesskey="u" rel="up">MVC</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Models-1"></span><h3 class="section">12.2 Models</h3>

<p>Models contains operations of database.
</p>
<p>For modifying tables, you should read <a href="#Migration">Migration</a>.
</p>
<p>For other DB operation, please read <a href="#FPRM-_0028experimental_0029">FPRM</a>.
</p>
<p>(To be continued&hellip;)
</p>
<hr>
<span id="Query-String"></span><div class="header">
<p>
Next: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="n" rel="next">Layouts and Rendering in GNU Artanis</a>, Previous: <a href="#MVC" accesskey="p" rel="prev">MVC</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Query-String-1"></span><h2 class="chapter">13 Query String</h2>

<p>A query string is a special part of a URL:
</p>
<div class="example">
<pre class="example">http://example.com/over/there?name=ferret&amp;color=purple
</pre></div>

<p>In this example, &quot;name&quot; and &quot;color&quot; are query strings with the values &quot;ferret&quot; and &quot;purple&quot; respectively.
It&rsquo;s useful to pass parameters to the server side like this.
</p>
<p>GNU Artanis provides a convenient API to handle query strings.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Query-string-from-GET" accesskey="1">Query string from GET</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Query-string-from-POST" accesskey="2">Query string from POST</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Query-string-from-GET"></span><div class="header">
<p>
Next: <a href="#Query-string-from-POST" accesskey="n" rel="next">Query string from POST</a>, Up: <a href="#Query-String" accesskey="u" rel="up">Query String</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Query-string-from-GET-1"></span><h3 class="section">13.1 Query string from GET</h3>

<p>The query string would be encoded in the URL on the GET method.
</p>
<div class="example">
<pre class="example">http://example.com/over/there?name=ferret&amp;color=purple
</pre></div>
<p>Please notice that URL-remapping supports regex. So you could register a URL rule like this:
</p><div class="example">
<pre class="example">(get &quot;/there?&quot;
  (lambda (rc)
    (get-from-qstr rc &quot;name&quot;)))
</pre></div>
<p>Or it will throw 404 since URL-remapping failed to hit the rule with the query string.
</p>
<hr>
<span id="Query-string-from-POST"></span><div class="header">
<p>
Previous: <a href="#Query-string-from-GET" accesskey="p" rel="prev">Query string from GET</a>, Up: <a href="#Query-String" accesskey="u" rel="up">Query String</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Query-string-from-POST-1"></span><h3 class="section">13.2 Query string from POST</h3>

<p>The query string would be encoded in the HTTP body on the POST method.
</p>
<p>There&rsquo;s only a slight difference when you pass query string by POST instead of with GET:
you don&rsquo;t need a URL rule using a regex, so the &quot;?&quot; is unnecessary here.
</p><div class="example">
<pre class="example">(post &quot;/there&quot; #:from-post 'qstr
      (lambda (rc)
        (:from-post rc 'get &quot;name&quot;)))
</pre></div>

<p>Please notice that <code>#:from-post 'qstr</code> is necessary when you&rsquo;re trying to
get data from POST. And you should use <code>:from-post</code> to get related data
from query-string.
</p>
<div class="example">
<pre class="example">#:from-post &lt;mode&gt;
</pre></div>

<p>The mode includes:
</p><ul>
<li> <code>#t</code> or <code>'qstr</code>: handle query-string for you.
</li><li> <code>'json</code>: returns a parsed json as hashtable.
</li><li> <code>'qstr-safe</code>: similar to &rsquo;qstr, but try to eliminate evil HTML entities first.
</li><li> <code>'bv</code>: returns the body as bytevector.
</li><li> <code>'store rest ...</code>: It&rsquo;s for <a href="#Upload-files">Upload files</a>.
</li></ul>

<p>The reason to design :from-post is for the efficient purpose.
Artanis will not try to auto parse POST body as query-string for at least 2
reasons:
</p><ul>
<li> 1. It may not be query-string, maybe json, or uploaded file
</li><li> 2. It may be long query-string, and could be deleyed to parse. This is
</li></ul>
<p>useful to avoid redundant parsing. However, each time you call
<code>:from-post</code>, it will parse the query-string again, the correct way to
fetch multiple values is:
</p><div class="example">
<pre class="example">(:from-post rc 'get-vals &quot;key1&quot; &quot;key2&quot; &quot;key3&quot;)

;; For example:
;; let-values is imported from srfi-11
(let-values (((title sub-title old-passwd new-passwd)
              (:from-post rc 'get-vals &quot;title&quot; &quot;sub-title&quot;
                          &quot;old-passwd&quot; &quot;new-passwd&quot;)))
  ..........
  )
</pre></div>

<p>BTW, you may get the parsed query-string as an assoc-list as well:
</p><div class="example">
<pre class="example">(let ((qstr (:from-post rc 'get)))
  (assoc-ref qstr &quot;key-1&quot;))
</pre></div>

<hr>
<span id="Layouts-and-Rendering-in-GNU-Artanis"></span><div class="header">
<p>
Next: <a href="#Databases" accesskey="n" rel="next">Databases</a>, Previous: <a href="#Query-String" accesskey="p" rel="prev">Query String</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Layouts-and-Rendering-in-GNU-Artanis-1"></span><h2 class="chapter">14 Layouts and Rendering in GNU Artanis</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Templating" accesskey="1">Templating</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Templating-for-Pythoners" accesskey="2">Templating for Pythoners</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Templating-for-Rubyists" accesskey="3">Templating for Rubyists</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Templating-APIs" accesskey="4">Templating APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Embedded-Templates" accesskey="5">Embedded Templates</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SXML-Templates" accesskey="6">SXML Templates</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Templating"></span><div class="header">
<p>
Next: <a href="#Templating-for-Pythoners" accesskey="n" rel="next">Templating for Pythoners</a>, Up: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="u" rel="up">Layouts and Rendering in GNU Artanis</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Templating-1"></span><h3 class="section">14.1 Templating</h3>

<p>Templating provides a way to mix programmatic code into HTML.
</p>
<hr>
<span id="Templating-for-Pythoners"></span><div class="header">
<p>
Next: <a href="#Templating-for-Rubyists" accesskey="n" rel="next">Templating for Rubyists</a>, Previous: <a href="#Templating" accesskey="p" rel="prev">Templating</a>, Up: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="u" rel="up">Layouts and Rendering in GNU Artanis</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Templating-for-Pythoners-1"></span><h3 class="section">14.2 Templating for Pythoners</h3>

<p>If you&rsquo;re familiar with Django, which implemented a DSL(Domain Specific Language) to express presentation rather than program logic. Templating in GNU Artanis follows a different philosophy.
</p>
<p>Templating in GNU Artanis, is just writing Scheme code in the HTML document. Why? Because of the philosophy of FP(Functional Programming), everything is a function. So, <code>(filesizeformat size)</code> is easy enough to grasp for anyone with scheme experience. It&rsquo;s just a simple function calling in prefix-notation. There&rsquo;s no need to implement DSL like <code>size|filesizeformat</code> to increase the complexity of code. Let alone the syntax is very different from Python.
</p>
<p>The syntax <code>size | filesizeformat</code> follows postfix-notation, used in stack-based languages, say Forth. Such a language used to delegate another programming paradigm named concatenative programming. It&rsquo;s very different from the paradigm of Scheme (functional programming), and the paradigm of Python (imperative programming).
</p>
<p>The philosophy of GNU Artanis templating is to bring it into correspondence with the paradigm of the language. And reduce unnecessary complexities. <a href="http://en.wikipedia.org/wiki/KISS_principle">KISS</a>.
</p>
<hr>
<span id="Templating-for-Rubyists"></span><div class="header">
<p>
Next: <a href="#Templating-APIs" accesskey="n" rel="next">Templating APIs</a>, Previous: <a href="#Templating-for-Pythoners" accesskey="p" rel="prev">Templating for Pythoners</a>, Up: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="u" rel="up">Layouts and Rendering in GNU Artanis</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Templating-for-Rubyists-1"></span><h3 class="section">14.3 Templating for Rubyists</h3>

<p>Templating in GNU Artanis looks very similar to Rails.
</p>
<p>The Rails code:
</p>
<div class="example">
<pre class="example">&lt;% if( @fullscreen == 1 ) %&gt;
&lt;%= &quot;&lt;div class='full'&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;&quot; %&gt;
&lt;% end %&gt;
</pre></div>

<p>And the same function in GNU Artanis code:
</p>
<div class="example">
<pre class="example">&lt;% (if (= fullscreen 1) %&gt;
       &lt;% &quot;&lt;div class='full'&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;&quot; %&gt;
       &lt;% ) %&gt;
</pre></div>

<hr>
<span id="Templating-APIs"></span><div class="header">
<p>
Next: <a href="#Embedded-Templates" accesskey="n" rel="next">Embedded Templates</a>, Previous: <a href="#Templating-for-Rubyists" accesskey="p" rel="prev">Templating for Rubyists</a>, Up: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="u" rel="up">Layouts and Rendering in GNU Artanis</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Templating-APIs-1"></span><h3 class="section">14.4 Templating APIs</h3>

<div class="example">
<pre class="example">(tpl-&gt;response filename/sxml [environment &lt;- (the-environment)] [escape? &lt;- #f])

(tpl-&gt;html filename/sxm [environment &lt;- (the-environment)] [escape? &lt;- #f])
</pre></div>

<p><em>The difference is that tpl-&gt;html returns a string, but tpl-&gt;response returns an HTTP object response.</em>
</p>
<p>[environment] is the environment you want to use. We often ignore it. If you want to ref some vars defined outside your
template string, you need to pass this variable.
</p>
<p>[escape?] If you want to char-escape the HTML with the returned string, set it to #t.
</p>
<p>There are two main ways of writing templates:
</p>
<hr>
<span id="Embedded-Templates"></span><div class="header">
<p>
Next: <a href="#SXML-Templates" accesskey="n" rel="next">SXML Templates</a>, Previous: <a href="#Templating-APIs" accesskey="p" rel="prev">Templating APIs</a>, Up: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="u" rel="up">Layouts and Rendering in GNU Artanis</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Embedded-Templates-1"></span><h3 class="section">14.5 Embedded Templates</h3>

<p>Example:
Write a tpl file named &quot;my.tpl&quot;:
</p><div class="example">
<pre class="example">&lt;html&gt;
  &lt;p&gt; &lt;%= &quot;This is tpl test!&quot; %&gt; &lt;/p&gt;
  &lt;p&gt; &lt;% (format #t &quot;And this is ~a&quot; (getcwd)) %&gt; &lt;/p&gt;
  &lt;p&gt; &lt;%= external-var %&gt; &lt;/p&gt;
&lt;/html&gt;
</pre></div>

<p>The filename extension &quot;.tpl&quot; is mandatory when using the MVC. Since the MVC will find the template by detecting
controller name automatically.
</p>
<p>If you don&rsquo;t use the MVC, and are rather writing all in one script
file loading GNU Artanis modules. Then you don&rsquo;t need to follow this rule.
</p>
<p><strong>NOTE:</strong> Don&rsquo;t wrap code in double-quotes, for example:
</p><div class="example">
<pre class="example">&lt;a href=&quot;&lt;%= my-url %&gt;&quot;&gt;click me&lt;/a&gt; &lt;!-- Wrong! --&gt;
&lt;a href=&lt;%= my-url %&gt; &gt;click me&lt;/a&gt; &lt;!-- Correct! --&gt;
</pre></div>

<p>If you need to output a double-quoted string, please use <code>object-&gt;string</code> to convert in Scheme first.
</p><div class="example">
<pre class="example">&lt;a href=&lt;%= (object-&gt;string my-url) %&gt; &gt;click me&lt;/a&gt; &lt;!-- If my-url is not properly quoted --&gt;
</pre></div>

<div class="example">
<pre class="example">(get &quot;/test&quot;
  (lambda (rc)
    (let ((external-var 123))
      (tpl-&gt;response &quot;my.tpl&quot; (the-environment)))))
(run #:port 8080)
</pre></div>

<p>In this case, make sure to put my.tpl in the same path as your GNU Artanis code.
</p>
<p>Since <strong>external-var</strong> is defined outside the file &quot;my.tpl&quot;, and it&rsquo;s bound in <em>let</em> with 123, you have to pass (the-environment). Or the template render will complain aobut not being able to find the variable <strong>external-var</strong>.
</p>
<p>If you don&rsquo;t need to refer to any external vars, just use <code>(tpl-&gt;response &quot;file.tpl&quot;)</code>.
</p>
<p>To test, access <a href="http://localhost:3000/test">http://localhost:3000/test</a> in your browser.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Template-special-commands" accesskey="1">Template special commands</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Template-special-commands"></span><div class="header">
<p>
Up: <a href="#Embedded-Templates" accesskey="u" rel="up">Embedded Templates</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Template-special-commands-1"></span><h4 class="subsection">14.5.1 Template special commands</h4>

<p>GNU Artanis provides special helper commands.
</p>
<p>Please notice that GNU Artanis constrains the path of sources in the application directory for
security reasons. The resources files, CSS, JS etc, should be put int <strong>pub</strong> directory in
the application directory, or the client won&rsquo;t be able to access them.
</p>
<p>These special commands are useful to expand the path for you, and they should be added
into the tamplate file, for example:
</p><div class="example">
<pre class="example">&lt;html&gt;
  &lt;head&gt;
    &lt;@icon favicon.ico %&gt;
      &lt;@js functions.js %&gt;
        &lt;@css blog.css %&gt;
  &lt;/head&gt;

  &lt;@include sidebar.html %&gt;

    &lt;body&gt;
      ...
    &lt;/body&gt;
&lt;/html&gt;
</pre></div>

<p><strong>NOTE:</strong> The command name is prefixed with <strong>@</strong>, as, <strong>@include</strong>, <strong>@css</strong>, etc. Please do
not seperate the <strong>@</strong>, or it will throw exception.
</p>
<p>You can include html files with the <strong>include</strong> command:
</p><div class="example">
<pre class="example">;; @include is the command name, not &lt;@ include filename %&gt;
&lt;@include filename.html %&gt;
</pre></div>
<p>This will be expanded like this:
</p><div class="example">
<pre class="example">/current_toplevel/pub/filename.html
</pre></div>
<p><strong>NOTE:</strong> Please make sure the included file is in the <strong>pub</strong> directory in the application
directory.
</p>
<p>To refer to a CSS file:
</p><div class="example">
<pre class="example">&lt;@css filename.css %&gt;
</pre></div>
<p>This will be expanded like this:
</p><div class="example">
<pre class="example">&lt;link rel=&quot;stylesheet&quot; href=&quot;/pub/css/filename.css&quot;&gt;
</pre></div>

<p>To refer to a JS (javascript) file in the HTML head:
</p><div class="example">
<pre class="example">&lt;@js filename.js %&gt;
</pre></div>
<p>This will be expanded like this:
</p><div class="example">
<pre class="example">&lt;script type=&quot;text/javascript&quot; src=&quot;/pub/js/filename.js&quot;&gt; &lt;/script&gt;
</pre></div>

<p>To specify an icon for the domain:
</p><div class="example">
<pre class="example">&lt;@icon favicon.ico %&gt;
</pre></div>
<p>This will be expanded like this:
</p><div class="example">
<pre class="example">&lt;link rel=&quot;icon&quot; href=&quot;/pub/img/favicon.ico&quot; type=&quot;image/x-icon&quot;&gt;
</pre></div>

<hr>
<span id="SXML-Templates"></span><div class="header">
<p>
Previous: <a href="#Embedded-Templates" accesskey="p" rel="prev">Embedded Templates</a>, Up: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="u" rel="up">Layouts and Rendering in GNU Artanis</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="SXML-Templates-1"></span><h3 class="section">14.6 SXML Templates</h3>

<p><a href="http://en.wikipedia.org/wiki/SXML">SXML</a> is an alternative syntax for writing XML data, using the form of S-expressions.
</p>
<p>SXML is to Scheme as JSON is to ECMAScript(the so-called Javascript). Maybe this explains it clearer.
</p>
<p>One benefit of SXML is that it takes advantage of the quasiquote in Scheme. Please search in the internet &quot;scheme quasiquote&quot; for more details.
</p>
<p>This is an SXML expression:
</p><div class="example">
<pre class="example">(tpl-&gt;response '(html (body (p (@ (id &quot;content&quot;)) &quot;hello world&quot;))))
</pre></div>

<p>The above would result the following HTML code:
</p><div class="example">
<pre class="example">&lt;html&gt;&lt;body&gt;&lt;p id=&quot;content&quot;&gt;hello world&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</pre></div>

<p>Sometimes you may need quasiquote to refer to a variable, for example:
</p>
<div class="example">
<pre class="example">(let ((content &quot;hello world&quot;))
  (tpl-&gt;response `(html (body (p (@ (id &quot;content&quot;)) ,content)))))
</pre></div>
<p>Here, the &quot;html&quot; block is being quoted with the backtick, which in combination with
a &quot;,&quot; character before the variable name, makes the variable be referred to instead
of just passing a string.
</p>
<hr>
<span id="Databases"></span><div class="header">
<p>
Next: <a href="#RESTful-API" accesskey="n" rel="next">RESTful API</a>, Previous: <a href="#Layouts-and-Rendering-in-GNU-Artanis" accesskey="p" rel="prev">Layouts and Rendering in GNU Artanis</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Databases-1"></span><h2 class="chapter">15 Databases</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#DB-init-hooks" accesskey="1">DB init hooks</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#DB-connection-pool" accesskey="2">DB connection pool</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Migration" accesskey="3">Migration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#ORM-problem" accesskey="4">ORM problem</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SSQL" accesskey="5">SSQL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#FPRM-_0028experimental_0029" accesskey="6">FPRM (experimental)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SQL-Mapping-_0028experimental_0029" accesskey="7">SQL Mapping (experimental)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="DB-init-hooks"></span><div class="header">
<p>
Next: <a href="#DB-connection-pool" accesskey="n" rel="next">DB connection pool</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="DB-init-hooks-1"></span><h3 class="section">15.1 DB init hooks</h3>

<p>Sometimes you need to do some configurations before using DB, Artanis provide an API
for that, you should put it to ENTRY file before run the server.
</p>
<p>For example, assuming you&rsquo;re using MySQL/MariaDB, and you need to configure it to UTF-8,
you should add these lines to you ENTRY file. Or if you&rsquo;re using minimal mode without
application folder, just put it before running the server.
</p>
<div class="example">
<pre class="example">(run-when-DB-init!
 (lambda (conn)
   (DB-query conn &quot;set names utf8;&quot;)))
</pre></div>

<p><strong>NOTE: Don&rsquo;t forget &lsquo;!&rsquo; here, it implies the side-effects in Scheme!</strong>
</p>
<hr>
<span id="DB-connection-pool"></span><div class="header">
<p>
Next: <a href="#Migration" accesskey="n" rel="next">Migration</a>, Previous: <a href="#DB-init-hooks" accesskey="p" rel="prev">DB init hooks</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="DB-connection-pool-1"></span><h3 class="section">15.2 DB connection pool</h3>

<p>GNU Artanis will create a connection pool when you run <code>art work</code>.
Its size is decided by <code>db.poolsize</code>.
The pool is increasing by default for development and test.
It is strongly recommended you to set <code>db.pool</code> to <code>fixed</code> when you deploy.
The increasing pool will cause the effects that is similar to the memory leak. If you set it to fixed, then the request handler will be
safely scheduled when there&rsquo;s no available DB connection, and it will be awake when it&rsquo;s available.
</p>
<hr>
<span id="Migration"></span><div class="header">
<p>
Next: <a href="#ORM-problem" accesskey="n" rel="next">ORM problem</a>, Previous: <a href="#DB-connection-pool" accesskey="p" rel="prev">DB connection pool</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Migration-1"></span><h3 class="section">15.3 Migration</h3>

<p>Migrations provide a way to do complicated modification of tables in a database by GNU Artanis.
Here&rsquo;s an example.
</p>
<p>First, draw a migration:
</p><div class="example">
<pre class="example"># art draw migration person
drawing    migration person
working    Migration `20151107040209_person.scm'
</pre></div>
<p>You&rsquo;ll see something similar like above.
</p>
<p>Then you&rsquo;d edit the file db/migration/20151107040209_person.scm:
</p><div class="example">
<pre class="example">(migrate-up
 (create-table
  'person
  '(id auto (#:primary-key))
  '(name char-field (#:not-null #:maxlen 10))
  '(age tiny-integer (#:not-null))
  '(email char-field (#:maxlen 20))))

(migrate-down
 (drop-table 'person))
</pre></div>

<p>Then you run the <strong>up</strong> command for migration:
</p><div class="example">
<pre class="example">art migrate up person
</pre></div>

<p>Then migrate-up function will be called, and this will create a table named <em>person</em>:
</p><div class="example">
<pre class="example">+-------+---------------------+------+-----+---------+----------------+
| Field | Type                | Null | Key | Default | Extra          |
+-------+---------------------+------+-----+---------+----------------+
| id    | bigint(20) unsigned | NO   | PRI | NULL    | auto_increment |
| name  | varchar(10)         | NO   |     | NULL    |                |
| age   | tinyint(4)          | NO   |     | NULL    |                |
| email | varchar(20)         | YES  |     | NULL    |                |
+-------+---------------------+------+-----+---------+----------------+
</pre></div>

<p>If you run the <strong>down</strong> command of migration, as:
</p><div class="example">
<pre class="example">art migrate down person
</pre></div>
<p>The table <em>person</em> will be dropped.
</p>
<hr>
<span id="ORM-problem"></span><div class="header">
<p>
Next: <a href="#SSQL" accesskey="n" rel="next">SSQL</a>, Previous: <a href="#Migration" accesskey="p" rel="prev">Migration</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="ORM-problem-1"></span><h3 class="section">15.4 ORM problem</h3>

<p>ORM stands for Object Relational Mapping, which is a popular approach to handle relational DB nowadays, especially for Object-Oriented Programming.
</p>
<p>Of course, Guile has it&rsquo;s own Object System named <a href="https://www.gnu.org/software/guile/manual/html_node/GOOPS.html#GOOPS">GOOPS</a>. Users can use OOP with it. And it&rsquo;s possible to implement ORM in GNU Artanis as well.
</p>
<p>However, FP fans realized that they don&rsquo;t have to use OOP if they can use FP features reasonably.
</p>
<p>Besides, there&rsquo;re some critics about ORM:
</p><ul>
<li> <a href="http://martinfowler.com/bliki/OrmHate.html">ORM Hate</a>

</li><li> <a href="http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx">Vietnam of Computer Science</a>

</li><li> <a href="http://blog.codinghorror.com/object-relational-mapping-is-the-vietnam-of-computer-science/">Object-Relational Mapping is the Vietnam of Computer Science</a>
</li></ul>

<p>Here are some known ways to solve ORM related problems:
</p>
<ul>
<li> 1. <strong><em>Give up ORM</em></strong>.
</li></ul>


<ul>
<li> 2. <strong><em>Give up relational storage model</em></strong>. Don&rsquo;t use a relational DB. Use another DB style, such as No-SQL. Well, this way is not cool when you must use a relational DB.
</li></ul>


<ul>
<li> 3. <strong><em>Manual mapping</em></strong>. Write SQL code directly. It&rsquo;s fine sometimes. But the code increases when things get complicated. Refactoring and reusing would be worth to consider.
</li></ul>


<ul>
<li> 4. <strong><em>Limited ORM</em></strong>. Limiting the utility of ORM. And use ORM to solve part of your work rather than whole, depends on you. This may avoid some problems.
</li></ul>


<ul>
<li> 5. <strong><em>SQL related DSL</em></strong>. Design a new language. Microsoft&rsquo;s LINQ is such a case.
</li></ul>


<ul>
<li> 6. <strong><em>Integration of relational concepts into frameworks</em></strong>. Well, harder than 5, but worth to try.
</li></ul>


<ul>
<li> 7. <strong><em>Stateless</em></strong>. This is the critical hit to counter complexity and unreliability.
</li></ul>

<p>Basically, GNU Artanis has no ORM yet, and maybe never will. GNU Artanis is trying to experiment new ways to solve the problems of ORM.
</p>
<p>GNU Artanis provides three ways to complete this mission. All of them, are <strong>experimental</strong> at present.
</p>
<ul>
<li> SSQL (1,3,5)

</li><li> FPRM (4,7)

</li><li> SQL Mapping (1,3,6)
</li></ul>

<hr>
<span id="SSQL"></span><div class="header">
<p>
Next: <a href="#FPRM-_0028experimental_0029" accesskey="n" rel="next">FPRM (experimental)</a>, Previous: <a href="#ORM-problem" accesskey="p" rel="prev">ORM problem</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="SSQL-1"></span><h3 class="section">15.5 SSQL</h3>

<p>The concept of SSQL is to write SQL in <a href="https://en.wikipedia.org/wiki/S-expression">s-expression</a>.
</p>
<p>Usage:
</p><div class="example">
<pre class="example">(-&gt;sql sql-statement)
(where #:key val ... [literal string])
(having #:key val ... [literal string])
(/or conds ...)
(/and conds ...)
</pre></div>

<p>For example:
</p><div class="example">
<pre class="example">(-&gt;sql select * from 'Persons (where #:city &quot;Shenzhen&quot;))
(-&gt;sql select '(age name) from 'Persons (where &quot;age &lt; 30&quot;))
</pre></div>
<p>The SQL update command is quite different to SQL grammar. Example:
</p><div class="example">
<pre class="example">(-&gt;sql update 'table set (list (list phone_number &quot;13666666666&quot;)) (where #:name &quot;john&quot;))
</pre></div>

<hr>
<span id="FPRM-_0028experimental_0029"></span><div class="header">
<p>
Next: <a href="#SQL-Mapping-_0028experimental_0029" accesskey="n" rel="next">SQL Mapping (experimental)</a>, Previous: <a href="#SSQL" accesskey="p" rel="prev">SSQL</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="FPRM-_0028experimental_0029-1"></span><h3 class="section">15.6 FPRM (experimental)</h3>

<p>FPRM stands for Functional Programming Relational Mapping. It&rsquo;s a new word I invented. But it&rsquo;s not new concept. FP here indicates <strong>stateless</strong>.
</p>
<p><em>FPRM is still experimental and work-in-progress.</em>
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Connect-to-DB-server" accesskey="1">Connect to DB server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Map-DB-table" accesskey="2">Map DB table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Create-table" accesskey="3">Create table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Get-columns-from-table" accesskey="4">Get columns from table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Set-values-to-table" accesskey="5">Set values to table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Drop-a-table" accesskey="6">Drop a table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Check-existence-of-table" accesskey="7">Check existence of table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Get-schema-of-a-table" accesskey="8">Get schema of a table</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Connect-to-DB-server"></span><div class="header">
<p>
Next: <a href="#Map-DB-table" accesskey="n" rel="next">Map DB table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Connect-to-DB-server-1"></span><h4 class="subsection">15.6.1 Connect to DB server</h4>

<div class="example">
<pre class="example">;; usage 1:
(connect-db dbd init-str)

;; usage 2:
(connect-db dbd #:db-name &quot;artanis&quot; #:db-username &quot;root&quot; #:db-passwd &quot;&quot;
            #:proto &quot;tcp&quot; #:host &quot;localhost&quot; #:port 3306)
</pre></div>

<ul>
<li> <strong>dbd</strong> is a string. It must match any of these: &quot;mysql&quot;, &quot;postgresql&quot;, or &quot;sqlite3&quot;.
</li></ul>


<ul>
<li> <strong>init-str</strong> is a string for DB init, for example:
</li></ul>
<div class="example">
<pre class="example">(connect-db &quot;mysql&quot; &quot;root:123:artanis:tcp:localhost:3306&quot;)
</pre></div>

<ul>
<li> <code>#:db-name</code> specifies the DB name.
</li></ul>


<ul>
<li> <code>#:db-username</code> specifies the DB username.
</li></ul>


<ul>
<li> <code>#:proto</code> specifies the socket protocol, which is related to the DB server of your choice.
</li></ul>


<ul>
<li> <code>#:host</code> specifies the host name.
</li></ul>


<ul>
<li> <code>#:port</code> specifies the socket port.
</li></ul>

<hr>
<span id="Map-DB-table"></span><div class="header">
<p>
Next: <a href="#Create-table" accesskey="n" rel="next">Create table</a>, Previous: <a href="#Connect-to-DB-server" accesskey="p" rel="prev">Connect to DB server</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Map-DB-table-1"></span><h4 class="subsection">15.6.2 Map DB table</h4>

<p>This step will generate an new instance (as a closure) mapped to database table or view.
In ORM, it is often called an <a href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">Active Record.</a> It maps the database view to a class object.
</p>
<p>There are two main differences to SSQL:
</p><ul>
<li> FPRM doesn&rsquo;t create an object for each table. It maps the whole database, and generates an SQL for each table as you use it. So it might be lighter compared to an ORM object.
</li><li> FPRM doesn&rsquo;t maintain any states at all. It&rsquo;s stateless as an object (Not in the database).
</li></ul>

<p>These two points may decrease the power of FPRM, but our main philosophy in GNU Artanis is that
</p><ul>
<li> <em>The best way to control DB is SQL, don&rsquo;t bother with other guile schemes.</em>
</li></ul>

<p>That means we&rsquo;re not going to develop a complicated ORM in GNU Artanis, but a promising way to interact with SQL easily.
This is what <a href="#SQL-Mapping-_0028experimental_0029">SQL Mapping</a> provided. FPRM aims to reduce states &amp; complexity to provide reliability. And SQL-Mapping will provide a convenient way
to handle complex SQL queries for better performance and security (SQL-Injection, etc).
</p>
<div class="example">
<pre class="example">(define m (map-table-from-DB rc/conn))
</pre></div>

<p><strong>rc/conn</strong> can be a route-context or a DB connection.
</p>
<p>map-table-from-DB returns a function, named <strong>m</strong> here for simplicity.
</p>
<hr>
<span id="Create-table"></span><div class="header">
<p>
Next: <a href="#Get-columns-from-table" accesskey="n" rel="next">Get columns from table</a>, Previous: <a href="#Map-DB-table" accesskey="p" rel="prev">Map DB table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Create-table-1"></span><h4 class="subsection">15.6.3 Create table</h4>

<div class="example">
<pre class="example">(m 'create table-name defs #:if-exists? #f #:primary-keys '() #:engine #f)
</pre></div>

<ul>
<li> <strong>table-name</strong> specifies the name of the DB table.
</li></ul>


<ul>
<li> <strong>defs</strong> is a list to define the type of columns. For example:
</li></ul>
<div class="example">
<pre class="example">'((name varchar 10) (age integer) (email varchar 20))
</pre></div>


<ul>
<li> <code>#:if-exists?</code> has two kinds of possible options:
<ul>
<li> &rsquo;<strong>overwrite</strong> and &rsquo;<strong>drop</strong>, which will overwrite the existing table.
</li><li> &rsquo;<strong>ignore</strong> means to ignore the table when it already exists.
</li></ul>
</li></ul>


<ul>
<li> <code>#:primary-keys</code> specifies the primary keys in the created table.
</li></ul>


<ul>
<li> <code>#:engine</code> specifies the DB engine. It depends on what dbd you chose.
</li></ul>

<hr>
<span id="Get-columns-from-table"></span><div class="header">
<p>
Next: <a href="#Set-values-to-table" accesskey="n" rel="next">Set values to table</a>, Previous: <a href="#Create-table" accesskey="p" rel="prev">Create table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Get-columns-from-table-1"></span><h4 class="subsection">15.6.4 Get columns from table</h4>

<div class="example">
<pre class="example">(m 'get table-name #:columns '(*) #:functions '() #:ret 'all
   #:group-by #f #:order-by #f)
</pre></div>

<ul>
<li> <code>#:column</code> is the list of columns to get.
</li></ul>


<ul>
<li> <code>#:functions</code> is a function to call, e.g:
</li></ul>
<div class="example">
<pre class="example">#:functions '((count Persons.Lastname))
</pre></div>


<ul>
<li> <code>#:ret</code> specifies how to return the result, there are three options:
<ul>
<li> &rsquo;all for returning all results
</li><li> &rsquo;top for returning the first result
</li><li> integer (larger than 0), to give it the end of a range from 0 to this number to give as result.
</li></ul>
</li></ul>


<ul>
<li> <code>#:group-by</code> used in conjunction with the aggregate functions to group the result-set by one or more columns.
</li></ul>


<ul>
<li> <code>#:order-by</code> used to sort the result-set by one or more columns.
</li></ul>


<p>For example, to get Lastname and City column, and return the first result.
</p><div class="example">
<pre class="example">(m 'get 'Persons #:columns '(Lastname City) #:ret 'top)
</pre></div>

<hr>
<span id="Set-values-to-table"></span><div class="header">
<p>
Next: <a href="#Drop-a-table" accesskey="n" rel="next">Drop a table</a>, Previous: <a href="#Get-columns-from-table" accesskey="p" rel="prev">Get columns from table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Set-values-to-table-1"></span><h4 class="subsection">15.6.5 Set values to table</h4>

<div class="example">
<pre class="example">(m 'set table-name . kargs)
</pre></div>

<p><strong>kargs</strong> is a var-list that takes key-value arguments.
</p>
<p>For example:
</p><div class="example">
<pre class="example">(m 'set 'Persons #:name &quot;nala&quot; #:age 99 #:email &quot;nala@artanis.com&quot;)
</pre></div>

<hr>
<span id="Drop-a-table"></span><div class="header">
<p>
Next: <a href="#Check-existence-of-table" accesskey="n" rel="next">Check existence of table</a>, Previous: <a href="#Set-values-to-table" accesskey="p" rel="prev">Set values to table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Drop-a-table-1"></span><h4 class="subsection">15.6.6 Drop a table</h4>

<div class="example">
<pre class="example">(m 'drop table-name)
</pre></div>

<hr>
<span id="Check-existence-of-table"></span><div class="header">
<p>
Next: <a href="#Get-schema-of-a-table" accesskey="n" rel="next">Get schema of a table</a>, Previous: <a href="#Drop-a-table" accesskey="p" rel="prev">Drop a table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Check-existence-of-table-1"></span><h4 class="subsection">15.6.7 Check existence of table</h4>

<div class="example">
<pre class="example">;; case sensitive
(m 'exists? table-name . columns)
;; or for case-insensitive
(m 'ci-exists? table-name . columns)
</pre></div>

<p>For example:
</p><div class="example">
<pre class="example">(m 'exists? 'Persons 'city 'lastname)
</pre></div>

<hr>
<span id="Get-schema-of-a-table"></span><div class="header">
<p>
Previous: <a href="#Check-existence-of-table" accesskey="p" rel="prev">Check existence of table</a>, Up: <a href="#FPRM-_0028experimental_0029" accesskey="u" rel="up">FPRM (experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Get-schema-of-a-table-1"></span><h4 class="subsection">15.6.8 Get schema of a table</h4>

<div class="example">
<pre class="example">(m 'schema table-name)
</pre></div>

<p><em>NOTE: all the returned names of the schema will be in lowercase.</em>
</p>
<hr>
<span id="SQL-Mapping-_0028experimental_0029"></span><div class="header">
<p>
Previous: <a href="#FPRM-_0028experimental_0029" accesskey="p" rel="prev">FPRM (experimental)</a>, Up: <a href="#Databases" accesskey="u" rel="up">Databases</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="SQL-Mapping-_0028experimental_0029-1"></span><h3 class="section">15.7 SQL Mapping (experimental)</h3>

<p>To be continued &hellip;
</p>
<hr>
<span id="RESTful-API"></span><div class="header">
<p>
Next: <a href="#MIME" accesskey="n" rel="next">MIME</a>, Previous: <a href="#Databases" accesskey="p" rel="prev">Databases</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="RESTful-API-1"></span><h2 class="chapter">16 RESTful API</h2>

<p>GNU Artanis provides a command <code>art api</code> to generate RESTful API skeleton, and the API version can be managed.
</p>
<div class="example">
<pre class="example">art api -c

creating   restful API v1
create     app/api/v1.scm
</pre></div>

<p>The generated file <strong>app/api/v1.scm</strong> will contain such a line:
</p><div class="example">
<pre class="example">(define-restful-api v1) ; DO NOT REMOVE THIS LINE!!!
</pre></div>

<p><strong>v1</strong> is the default version, if you may specify your prefered API version, for example, <strong>v3</strong>:
</p><div class="example">
<pre class="example">art api -c -v v3
</pre></div>
<p><code>-c</code> means to create.
</p>
<p>You should use <code>api-define</code> to define the RESTful API:
</p><div class="example">
<pre class="example">(api-define rule handler)
</pre></div>

<p><code>api-define</code> is an overloaded method of the controller define function. So you may use it like what you do with the controller in MVC. Here&rsquo;s a pseudo example:
</p><div class="example">
<pre class="example">(define (auth-err)
  (scm-&gt;json `((status ,status) (reason &quot;Auth error!&quot;))))

(api-define article/list
  (options #:mime 'json #:with-auth auth-err)
  (lambda (rc) ...)) 
</pre></div>
<p>Although the registered URL is <code>&quot;article/list&quot;</code>, the actual API would be <code>&quot;v1/article/list&quot;</code>, depends on the specified API version.
</p>
<hr>
<span id="MIME"></span><div class="header">
<p>
Next: <a href="#Upload-files" accesskey="n" rel="next">Upload files</a>, Previous: <a href="#RESTful-API" accesskey="p" rel="prev">RESTful API</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="MIME-1"></span><h2 class="chapter">17 MIME</h2>

<p><code>#:mime</code> method is used to return the proper MIME type in the HTTP response.
</p><div class="example">
<pre class="example">#:mime type ; for registering type
(:mime rc body) ; to emit the reponse with the proper MIME
</pre></div>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#JSON" accesskey="1">JSON</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#CSV" accesskey="2">CSV</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#XML" accesskey="3">XML</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SXML" accesskey="4">SXML</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="JSON"></span><div class="header">
<p>
Next: <a href="#CSV" accesskey="n" rel="next">CSV</a>, Up: <a href="#MIME" accesskey="u" rel="up">MIME</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="JSON-1"></span><h3 class="section">17.1 JSON</h3>

<p>GNU Artanis integrates the third-party module <a href="https://github.com/aconchillo/guile-json">guile-json</a> to parse json.
You can use the #:mime method to handle JSON:
</p><div class="example">
<pre class="example">(get &quot;/json&quot; #:mime 'json
     (lambda (rc)
       (let ((j (scm-&gt;json-string '((&quot;name&quot; . &quot;nala&quot;) (&quot;age&quot; . 15)))))
         (:mime rc j))))
</pre></div>

<p>For example:
</p><div class="example">
<pre class="example">(define my-json
  '((name . nala) (age . 15)
    (read_list
     (&quot;book1&quot; &quot;The interpreter and structure of Artanis&quot;)
     (&quot;book2&quot; &quot;The art of Artanis programming&quot;))))
(scm-&gt;json-string my-json) ; scm-&gt;json will print a json string
;; ==&gt; {&quot;name&quot; : &quot;nala&quot;,
;;      &quot;age&quot; : 15,
;;      &quot;read_list&quot; : {&quot;book2&quot; : &quot;The art of Artanis programming&quot;,
;;                     &quot;book1&quot; : &quot;The interpreter and structure of Artanis&quot;}}
</pre></div>

<p><code>scm-&gt;json</code> will return a hash-table to represent a JSON object.
</p>
<p>If you need to format JSON as a string to return to the client, please use <code>scm-&gt;json-string</code>.
</p>
<hr>
<span id="CSV"></span><div class="header">
<p>
Next: <a href="#XML" accesskey="n" rel="next">XML</a>, Previous: <a href="#JSON" accesskey="p" rel="prev">JSON</a>, Up: <a href="#MIME" accesskey="u" rel="up">MIME</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="CSV-1"></span><h3 class="section">17.2 CSV</h3>

<p>GNU Artanis integrates the third-party module <a href="https://github.com/NalaGinrut/guile-csv">guile-csv</a> to parse csv.
You can use the #:mime method to handle CSV:
</p><div class="example">
<pre class="example">(get &quot;/csv&quot; #:mime 'csv
     (lambda (rc)
       (:mime rc '((&quot;a&quot; &quot;1&quot;) (&quot;b&quot; &quot;2&quot;)))))
</pre></div>

<hr>
<span id="XML"></span><div class="header">
<p>
Next: <a href="#SXML" accesskey="n" rel="next">SXML</a>, Previous: <a href="#CSV" accesskey="p" rel="prev">CSV</a>, Up: <a href="#MIME" accesskey="u" rel="up">MIME</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="XML-1"></span><h3 class="section">17.3 XML</h3>

<p>In Scheme, XML is handled with SXML. Another way would be to append the text to a common string.
</p><div class="example">
<pre class="example">(get &quot;/xml&quot; #:mime 'xml
     (lambda (rc)
       (:mime rc '(*TOP* (WEIGHT (@ (unit &quot;pound&quot;))
                                 (NET (@ (certified &quot;certified&quot;)) &quot;67&quot;)
                                 (GROSS &quot;95&quot;))))))
</pre></div>

<p>The rendered result to the client will be:
</p><div class="example">
<pre class="example">&lt;WEIGHT unit=&quot;pound&quot;&gt;
  &lt;NET certified=&quot;certified&quot;&gt;67&lt;/NET&gt;
  &lt;GROSS&gt;95&lt;/GROSS&gt;
&lt;/WEIGHT&gt;
</pre></div>

<hr>
<span id="SXML"></span><div class="header">
<p>
Previous: <a href="#XML" accesskey="p" rel="prev">XML</a>, Up: <a href="#MIME" accesskey="u" rel="up">MIME</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="SXML-1"></span><h3 class="section">17.4 SXML</h3>

<p>You can use SXML to replace XML for exchanging data format. This way saves some bandwidth.
</p><div class="example">
<pre class="example">(get &quot;/sxml&quot; #:mime 'sxml
     (lambda (rc)
       (:mime rc '((a 1) (b 2)))))
</pre></div>

<hr>
<span id="Upload-files"></span><div class="header">
<p>
Next: <a href="#Sessions" accesskey="n" rel="next">Sessions</a>, Previous: <a href="#MIME" accesskey="p" rel="prev">MIME</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Upload-files-1"></span><h2 class="chapter">18 Upload files</h2>

<p>If you want to be able to upload files, store-uploaded-files is your friend.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Receive-an-upload-from-the-client" accesskey="1">Receive an upload from the client</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Send-an-upload-to-a-Server" accesskey="2">Send an upload to a Server</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Receive-an-upload-from-the-client"></span><div class="header">
<p>
Next: <a href="#Send-an-upload-to-a-Server" accesskey="n" rel="next">Send an upload to a Server</a>, Up: <a href="#Upload-files" accesskey="u" rel="up">Upload files</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Receive-an-upload-from-the-client-1"></span><h3 class="section">18.1 Receive an upload from the client</h3>

<p>The typical configuration of an uploading WebAPI looks like this:
</p>
<div class="example">
<pre class="example">(post &quot;/upload&quot; #:from-post '(store #:path &quot;upload&quot; #:sync #f)
      (lambda (rc)
        (case (:from-post rc 'store)
          ((success) (response-emit &quot;upload succeeded!&quot;))
          ((none) (response-emit &quot;No uploaded files!&quot;))
          (else (response-emit &quot;Impossible! please report bug!&quot;)))))
</pre></div>

<p>However, you may use the low-level API for more configurations as well:
</p><div class="example">
<pre class="example">(store-uploaded-files rc #:path (current-upload-path)
                      #:uid #f
                      #:gid #f
                      #:simple-ret? #t
                      #:mode #o664
                      #:path-mode #o775
                      #:sync #f)
</pre></div>

<p><strong>rc</strong> is the route-context.
</p>
<p><code>#:path</code> is the specified path to put uploaded files.
</p>
<p><code>#:uid</code> is new UID for the uploaded files, #f uses the default UID.
</p>
<p><code>#:gid</code> specifies the GID.
</p>
<p><code>#:simple-ret?</code> specifies the mode of return:
</p><ul>
<li> if #t, there&rsquo;re only two possible return value, &rsquo;success for success, &rsquo;none for nothing has been done.
</li><li> if #f, and while it&rsquo;s successful, it returns a list to show more details: (success size-list filename-list).
</li></ul>

<p><code>#:mode</code> chmod files to mode.
</p>
<p><code>#:path-mode</code> chmod upload path to mode.
</p>
<p><code>#:sync</code> sync while storing files.
</p>
<hr>
<span id="Send-an-upload-to-a-Server"></span><div class="header">
<p>
Previous: <a href="#Receive-an-upload-from-the-client" accesskey="p" rel="prev">Receive an upload from the client</a>, Up: <a href="#Upload-files" accesskey="u" rel="up">Upload files</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Send-an-upload-to-a-Server-1"></span><h3 class="section">18.2 Send an upload to a Server</h3>

<p>Although GNU Artanis is often used in server-side, we provide this function for users to upload files from the client.
</p><div class="example">
<pre class="example">(upload-files-to uri pattern)
</pre></div>

<p><strong>uri</strong> is standard HTTP URL:
</p><div class="example">
<pre class="example">scheme://[user:password@]domain:port/path?query_string#fragment_id
</pre></div>

<p><strong>pattern</strong> should be:  ((file filelist &hellip;) (data datalist &hellip;)), for example:
</p><div class="example">
<pre class="example">(upload-files-to &quot;ftp://nala:123@myupload.com/&quot;
                 '((data (&quot;data1&quot; &quot;hello world&quot;))
                   (file (&quot;file1&quot; &quot;filename&quot;) (&quot;file2&quot; &quot;filename2&quot;))))
</pre></div>

<hr>
<span id="Sessions"></span><div class="header">
<p>
Next: <a href="#Cookies" accesskey="n" rel="next">Cookies</a>, Previous: <a href="#Upload-files" accesskey="p" rel="prev">Upload files</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Sessions-1"></span><h2 class="chapter">19 Sessions</h2>

<p>You can use <code>#:session mode</code> to define a URL rule handler.
</p><div class="example">
<pre class="example">(post &quot;/auth&quot; #:session mode
      (lambda (rc) ...))
</pre></div>

<p><strong>mode</strong> can be:
</p><ul>
<li> #t or &rsquo;spawn, to spawn a new session, the name of the SID is &quot;sid&quot; by default.
</li><li> &lsquo;(spawn ,sid) to specify the name of the sid to spawn.
</li><li> &lsquo;(spawn ,sid ,proc) to specify the name of the sid and a proc to <strong>define your own session spawner</strong>.
</li></ul>

<p>And the APIs of the session is :session
</p><div class="example">
<pre class="example">(:session rc cmd)
</pre></div>

<p><strong>cmd</strong> can be:
</p><ul>
<li> &rsquo;check to check the session with name &quot;sid&quot;.
</li><li> &lsquo;(check ,sid) to check the session with a specified sid name.
</li><li> &rsquo;check-and-spawn to check &quot;sid&quot; first, if it doesn&rsquo;t exist, then spawn new.
</li><li> &lsquo;(check-and-spawn ,sid) to do the same as above, but with specifying the sid name.
</li><li> &lsquo;(check-and-spawn-and-keep ,sid) to check, then spawn, then keep, specifying the sid name.
</li><li> &rsquo;spawn to spawn a session with the name &quot;sid&quot;.
</li><li> &rsquo;spawn-and-keep to spawn a session then keep with the name &quot;sid&quot;.
</li><li> &rsquo;drop to remove the current session by &quot;sid&quot;.
</li><li> &lsquo;(drop ,sid) to remove the session by the specifed sid.
</li></ul>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Session-backend" accesskey="1">Session backend</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Session-backend"></span><div class="header">
<p>
Up: <a href="#Sessions" accesskey="u" rel="up">Sessions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Session-backend-1"></span><h3 class="section">19.1 Session backend</h3>

<p>Artanis provide several backends for implementing sessions in the lower-level. Please take a look
at the description of <code>session.backend</code> in your artanis.conf.
</p>
<hr>
<span id="Cookies"></span><div class="header">
<p>
Next: <a href="#Authentication" accesskey="n" rel="next">Authentication</a>, Previous: <a href="#Sessions" accesskey="p" rel="prev">Sessions</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Cookies-1"></span><h2 class="chapter">20 Cookies</h2>

<p>You can use <code>#:cookies mode</code> to define a URL rule handler.
</p><div class="example">
<pre class="example">(get &quot;/certain-rule&quot; #:cookies mode
     (lambda (rc) ...))
</pre></div>

<p><strong>mode</strong> can be:
</p><ul>
<li> (&rsquo;names names &hellip;) to specify the list name for the cookies.
</li><li> (&rsquo;custom (names &hellip;) maker setter getter modifier) to specify a more complicated customized cookie handler.
</li></ul>

<p>And the APIs:
</p><div class="example">
<pre class="example">(:cookies-set! rc cookie-name key val)

(:cookies-ref rc cookie-name key)

(:cookies-setattr! rc cookie-name #:expir #f #:domain #f
                   #:path #f #:secure #f #:http-only #f)

(:cookies-remove! rc key) ; remove cookie from client

(:cookies-update! rc) ; cookie operations won't work unless you update it
</pre></div>

<p><strong>NOTE</strong>: You don&rsquo;t have to call <code>:cookies-update!</code> yourself, since it will be called automatically by the hook before the response.
</p>
<p>For example:
</p><div class="example">
<pre class="example">(get &quot;/cookie&quot; #:cookies '(names cc)
     (lambda (rc)
       (:cookies-set! rc 'cc &quot;sid&quot; &quot;123321&quot;)
       &quot;ok&quot;))

(get &quot;/cookie/:expires&quot; #:cookies '(names cc)
     (lambda (rc)
       (:cookies-set! rc 'cc &quot;sid&quot; &quot;123321&quot;)
       (:cookies-setattr! rc 'cc #:expir (string-&gt;number (params rc &quot;expires&quot;)))
       &quot;ok&quot;))
</pre></div>

<p>You can use these commands in your console to see the results:
</p><div class="example">
<pre class="example">curl --head localhost:3000/cookie
# and
curl --head localhost:3000/cookie/120
</pre></div>

<hr>
<span id="Authentication"></span><div class="header">
<p>
Next: <a href="#Cache" accesskey="n" rel="next">Cache</a>, Previous: <a href="#Cookies" accesskey="p" rel="prev">Cookies</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Authentication-2"></span><h2 class="chapter">21 Authentication</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Init-Authentication" accesskey="1">Init Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Basic-Authentication" accesskey="2">Basic Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Common-Authentication" accesskey="3">Common Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Login-Authentication" accesskey="4">Login Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authenticate-checking" accesskey="5">Authenticate checking</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Customized-Authentication" accesskey="6">Customized Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-Authentication" accesskey="7">Websocket Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#HMAC" accesskey="8">HMAC</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Init-Authentication"></span><div class="header">
<p>
Next: <a href="#Basic-Authentication" accesskey="n" rel="next">Basic Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Init-Authentication-1"></span><h3 class="section">21.1 Init Authentication</h3>

<p>GNU Artanis provides flexible mechanism for authentication.
</p>
<p>You can use <code>#:auth mode</code> to define a URL rule handler.
</p><div class="example">
<pre class="example">(get &quot;/certain-rule&quot; #:auth mode
     (lambda (rc) ...))
</pre></div>

<p><strong>mode</strong> can be:
</p><ul>
<li> SQL as <a href="#String-Template">string template</a>. You can write your own custom SQL string to fetch &amp; check your username and password.
</li><li> <code>('basic (lambda (rc user passwd) ...))</code> init Basic Authentication mode. <em>user</em> is the username, and <em>passwd</em> is the password.
</li><li> <code>('table table-name username-field passwd-field)</code> init a common Authentication mode. <strong>The passwd will be encrypted by the default algorithm</strong>.
</li><li> <code>('table table-name username-field passwd-field crypto-proc)</code> similar to the above item, but encrypt passwd with crypto-proc.
</li><li> <code>(table-name crypto-proc)</code>, so the passwd field will be &quot;passwd&quot; and username will be &quot;username&quot; by default.You can encrypt the passwd with crypto-proc.
</li></ul>

<p>Available crypto-proc helper functions listed here:
</p><div class="example">
<pre class="example">(string-&gt;md5 &lt;string&gt;)
(string-&gt;sha-1 &lt;string&gt;)
(string-&gt;sha-224 &lt;string&gt;)
(string-&gt;sha-256 &lt;string&gt;)
(string-&gt;sha-384 &lt;string&gt;)
(string-&gt;sha-512 &lt;string&gt;)
</pre></div>

<p>NOTE: Please make sure that the <code>username-field</code> and <code>passwd-field</code> must be the same with
the field name specifed in the submit form of you web page code.
</p>
<p>For example, if there is a form on you page:
</p><div class="example">
<pre class="example">&lt;input type=&quot;password&quot; name=&quot;passwd&quot;&gt;
</pre></div>

<p>Please notice that name of password input was specified to <code>&quot;passwd&quot;</code>.
</p>
<p>Then you should write authentication like this:
</p>
<div class="example">
<pre class="example">(post &quot;/auth&quot; #:auth '(table user &quot;user&quot; &quot;passwd&quot;) #:session #t
      (lambda (rc) ...))
</pre></div>

<p>Please notice that the <code>&quot;passwd&quot;</code> here is the same with what you specified in the form.
</p>
<hr>
<span id="Basic-Authentication"></span><div class="header">
<p>
Next: <a href="#Common-Authentication" accesskey="n" rel="next">Common Authentication</a>, Previous: <a href="#Init-Authentication" accesskey="p" rel="prev">Init Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Basic-Authentication-1"></span><h3 class="section">21.2 Basic Authentication</h3>

<p>The HTTP Basic authentication (BA) implementation is the simplest technique for enforcing access control
to web resources, as it doesn&rsquo;t require cookies, session identifiers, or login pages. But rather uses
static, standard HTTP headers, which means that no extra handshakes are necessary for the connection.
</p>
<p>The BA mechanism provides no protection for the transmitted credentials. They are merely
encoded with Base64, but not encrypted or hashed in any way. For that reason, Basic Authentication
is typically used over HTTPS.
</p>
<p><em><strong>GNU Artanis doesn&rsquo;t support HTTPS at present. There are plans to support it in the future.</strong></em>
</p>
<p>Let&rsquo;s see a simple example:
</p><div class="example">
<pre class="example">(define (my-checker rc user passwd)
  (and (string=? user &quot;jack&quot;) (string=? passwd &quot;123&quot;)))

(post &quot;/bauth&quot; #:auth `(basic ,my-checker)
      (lambda (rc)
        (if (:auth rc)
            &quot;auth ok&quot;
            (throw-auth-needed))))
</pre></div>

<p>Another simple way to provide authentication is to compare the passsword stored in a database table:
</p><div class="example">
<pre class="example">(post &quot;/bauth&quot; #:auth `(basic Person username passwd)
      (lambda (rc) ... ))
</pre></div>

<p>NOTE: Assuming <strong>username</strong> and <strong>passwd</strong> are columns of the Person table.
</p>

<p>You have to define your own checker with the anonymous function <code>(lambda (rc u p) ...)</code>. #t to show success, and #f to fail.
</p>
<p>APIs:
</p>
<ul>
<li> <code>(:auth rc)</code> will check if Basic Authentication succeeded, #f if not.
</li><li> <code>(throw-auth-needed)</code> is a useful helper function to ask for auth in client side.
</li></ul>

<hr>
<span id="Common-Authentication"></span><div class="header">
<p>
Next: <a href="#Login-Authentication" accesskey="n" rel="next">Login Authentication</a>, Previous: <a href="#Basic-Authentication" accesskey="p" rel="prev">Basic Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Common-Authentication-1"></span><h3 class="section">21.3 Common Authentication</h3>

<p>There are multiple authentication methods that can be used by developers. Most of them are sort of tricky hacks. Here are the most common.
</p>
<p>The most common, and relatively safe way to authenticate, is to use the POST method, and check the username and passwd from a table in the DB.
</p>
<p>There are several ways to provide authentication.
</p>
<p>The simplest case is for <a href="#String-Template">String Template</a>:
</p><div class="example">
<pre class="example">#:auth &quot;string-template&quot;
</pre></div>

<p>If you save the account data in a database table, then you can use the table mode:
</p><div class="example">
<pre class="example">#:auth `(table ,table-name [,username-field] [,passwd-field] [,salt-field] [,hmac])
</pre></div>

<p>NOTE: The square-braced <strong>[args]</strong> above are optional.
</p>
<p>The default values for the optional items are:
</p><ul>
<li> username-field: username
</li><li> passwd-field: passwd
</li><li> salt-field: salt
</li></ul>

<p>TODO: remove the brackets for salt-field, as it says below that it&rsquo;s not optional.
And specify whether &quot;optional&quot; means that can be skipped or set to #f to use the default value.
</p>
<p><strong>GNU Artanis requires a salted password, it&rsquo;s not optional.</strong>
</p>
<p>So please prepare a field in a table for the salt string. It&rsquo;s your responsibility to generate a
salt string, please see <a href="#Random-String-Generator">Random String Generator</a>. When authenticating, please specify the
salt field name in the salt-field argument.
</p>
<p>For hmac item, please see <a href="#HMAC">HMAC</a>.
</p>
<hr>
<span id="Login-Authentication"></span><div class="header">
<p>
Next: <a href="#Authenticate-checking" accesskey="n" rel="next">Authenticate checking</a>, Previous: <a href="#Common-Authentication" accesskey="p" rel="prev">Common Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Login-Authentication-1"></span><h3 class="section">21.4 Login Authentication</h3>

<p>Usually, when doing a login, you will need both <code>#:auth</code> and <code>#:session</code> options for a long time session.
The first step is to authenticate, if it&rsquo;s successful, then spawn a new session for this request.
</p>
<p>Here is a simple example:
</p>
<div class="example">
<pre class="example">(post &quot;/auth&quot;
 #:auth '(table user &quot;user&quot; &quot;passwd&quot;)
 #:session #t
 (lambda (rc)
   (cond
    ((:session rc 'check) &quot;auth ok (session)&quot;)
    ((:auth rc)
     (:session rc 'spawn)
     &quot;auth ok&quot;)
    (else (redirect-to rc &quot;/login?login_failed=true&quot;)))))
</pre></div>

<p><strong>NOTE: The passwd will be encrypted by the default algorithm.</strong>
</p>
<hr>
<span id="Authenticate-checking"></span><div class="header">
<p>
Next: <a href="#Customized-Authentication" accesskey="n" rel="next">Customized Authentication</a>, Previous: <a href="#Login-Authentication" accesskey="p" rel="prev">Login Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Authenticate-checking-1"></span><h3 class="section">21.5 Authenticate checking</h3>

<p>If certain page requires authencation first, then how to check it properly?
</p>
<p>In GNU Artanis, the <strong>session-id</strong> is the only token to check if the client has already been authenticated.
By default, the <strong>session-id</strong> is named as <strong>SID</strong> in cookies.
You may use <code>#:with-auth</code> to do all the works automatically for you.
</p>
<div class="example">
<pre class="example">(get &quot;/dashboard&quot;
  #:with-auth &lt;options&gt;
  (lambda (rc)
    (view-render &quot;dashboard&quot; (the-environment))))
</pre></div>

<p>For example, assuming you have a page <strong>/dashboard</strong> requires login, then you may set <code>#:with-auth</code> with
certain option. We will explain this option later. Each time user visit <strong>/dashboard</strong> page, GNU Artanis will check if there&rsquo;s
valid <strong>session-id</strong> from client&rsquo;s cookies, if yes, then run the handler to generate the response; if no, then jump to the related
auth failed handler, depends on the option you specified.
</p>
<p>Here&rsquo;s available <strong>options</strong>:
</p><ul>
<li> <code>#t</code> means the default failure activity: redirect to <strong>/login</strong> page.
</li><li> URL in string, specify the login page URL. For example, <code>#:with-auth &quot;/admin/login&quot;</code>.
</li><li> <code>'status</code> will return a 401 page with status code 401, which could be checked by cilent.
</li><li> <strong>Thunk</strong> can be used to generate customized response by users. A thunk is a function without parameter.
For example, <code>#:with-auth (lambda () (scm-&gt;json-string '((status . 401) (reason . &quot;No auth&quot;))))</code>.
This is useful to customize your protocol in JSON for RESTful API.
</li></ul>

<p><strong>NOTE:</strong> Different from other <a href="#Shortcuts">shortcuts</a>, there&rsquo;s no <code>:with-auth</code> <strong>apply</strong> for user customized operations
inside the handler. If you use <code>#:with-auth</code>, then all related works are handled by GNU Artanis.
</p>
<hr>
<span id="Customized-Authentication"></span><div class="header">
<p>
Next: <a href="#Websocket-Authentication" accesskey="n" rel="next">Websocket Authentication</a>, Previous: <a href="#Authenticate-checking" accesskey="p" rel="prev">Authenticate checking</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Customized-Authentication-1"></span><h3 class="section">21.6 Customized Authentication</h3>

<div class="example">
<pre class="example">;; (define (checker username passwd) ...)
#:auth `(post ,username ,passwd ,checker)
</pre></div>
<p>This mode will parse and return <strong>username</strong> and <strong>password</strong> by the specified field name in query-string.
What matters here is that you can write your own checker for customization.
</p>
<hr>
<span id="Websocket-Authentication"></span><div class="header">
<p>
Next: <a href="#HMAC" accesskey="n" rel="next">HMAC</a>, Previous: <a href="#Customized-Authentication" accesskey="p" rel="prev">Customized Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-Authentication-1"></span><h3 class="section">21.7 Websocket Authentication</h3>

<p>See <a href="#Websocket-authentication">Websocket authencation</a>
</p>
<hr>
<span id="HMAC"></span><div class="header">
<p>
Previous: <a href="#Websocket-Authentication" accesskey="p" rel="prev">Websocket Authentication</a>, Up: <a href="#Authentication" accesskey="u" rel="up">Authentication</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="HMAC-1"></span><h3 class="section">21.8 HMAC</h3>

<p><a href="https://en.wikipedia.org/wiki/HMAC">HMAC</a> is a hash-based message authentication code.
It&rsquo;s dangerous to store the passwd in a raw string.
A safer way is to salt then hash with a strong cryptograpic hash function when storing the passwd.
</p>
<p>The default salt is a random string got from the operating system.
And the default cryptographic hash function is SHA256.
You can set your own HMAC function, as in this example:
</p>
<div class="example">
<pre class="example">(define (my-hmac passwd salt)
  (string-&gt;sha-512 (format #f &quot;~a-~a-~a&quot; passwd salt (current-time))))

(post &quot;/auth&quot; #:auth `(table user &quot;user&quot; &quot;passwd&quot; &quot;salt&quot; ,my-hmac)
      ...... )
</pre></div>

<p>The default HMAC function is:
</p><div class="example">
<pre class="example">(define (default-hmac passwd salt)
  (string-&gt;sha-256 (string-append passwd salt)))
</pre></div>

<p>For more on hash functions, please refer to <a href="#Cryptographic-hash-functions">Cryptographic hash functions</a>.
</p>
<hr>
<span id="Cache"></span><div class="header">
<p>
Next: <a href="#Shortcuts" accesskey="n" rel="next">Shortcuts</a>, Previous: <a href="#Authentication" accesskey="p" rel="prev">Authentication</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Cache-1"></span><h2 class="chapter">22 Cache</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#On-web-caching" accesskey="1">On web caching</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cache-APIs" accesskey="2">Cache APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="On-web-caching"></span><div class="header">
<p>
Next: <a href="#Cache-APIs" accesskey="n" rel="next">Cache APIs</a>, Up: <a href="#Cache" accesskey="u" rel="up">Cache</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="On-web-caching-1"></span><h3 class="section">22.1 On web caching</h3>

<p>Web caching is very important nowadays. This section discusses proper web
caching. It is not a full product guide document, but it may help to understand how to
cache data in GNU Artanis.
</p>
<p>(to be continued&hellip;)
</p>
<hr>
<span id="Cache-APIs"></span><div class="header">
<p>
Previous: <a href="#On-web-caching" accesskey="p" rel="prev">On web caching</a>, Up: <a href="#Cache" accesskey="u" rel="up">Cache</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Cache-APIs-1"></span><h3 class="section">22.2 Cache APIs</h3>

<p>You can use <code>#:cache mode</code> to define a URL rule handler.
</p><div class="example">
<pre class="example">(get &quot;/certain-rule&quot; #:cache mode
     (lambda (rc) ...))
</pre></div>

<p><strong><em>NOTE</em></strong>: the default value of &quot;maxage&quot; (3600 seconds) is defined by <code>cache.maxage</code> in <code>/etc/artanis/artanis.conf</code>.
</p>
<p><strong>mode</strong> can be:
</p><ul>
<li> <code>#t</code> to enable caching the page.
</li><li> <code>#f</code> to disable caching the page explicitly. It&rsquo;s the default value.
</li><li> <code>('static [maxage &lt;- 3600])</code> to be used for static files. The URL rule must be a real path to a static file.
</li><li> <code>(filename [maxage &lt;- 3600])</code> to cache a static file. This is useful when you don&rsquo;t want to reveal the actual path of the static file, but use a fake URL for it.
</li><li> <code>('public filename [maxage &lt;- 3600])</code> to allow proxies cache the content of specified static file. If HTTP authentication is required, responses are automatically set to &quot;private&quot;.
</li><li> <code>('private filename [maxage &lt;- 3600])</code> to not allow proxies cache the content of specified static file.
</li></ul>

<p>Let&rsquo;s set a simple cache setting for dynamic content:
</p><div class="example">
<pre class="example">(get &quot;/new&quot; #:cache #t
     (lambda (rc)
       (:cache rc &quot;hello world&quot;)))
</pre></div>

<p>If you want to cache a static file, and permit proxies cache the content:
</p><div class="example">
<pre class="example">(get &quot;/hide&quot; #:cache '(public &quot;pub/some.html&quot;)
     (lambda (rc)
       (:cache rc)))
</pre></div>

<p>But, if your current URL rule is used for authentication (once you use <code>#:auth</code>), the cache will be changed to <strong>private</strong> even if you specify <strong>public</strong>.
</p><div class="example">
<pre class="example">(get &quot;/pauth&quot;
  #:auth `(basic ,(lambda (rc u p) (and (string=? u &quot;nala&quot;)
                                        (string=? p &quot;123&quot;))))
  #:cache '(public &quot;pub/some.html&quot;) ; will be changed to 'private' forcely.
  (lambda (rc) (:cache rc)))
</pre></div>

<hr>
<span id="Shortcuts"></span><div class="header">
<p>
Next: <a href="#Websocket-_0028Experimental_0029" accesskey="n" rel="next">Websocket (Experimental)</a>, Previous: <a href="#Cache" accesskey="p" rel="prev">Cache</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Shortcuts-1"></span><h2 class="chapter">23 Shortcuts</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#What-is-shortcuts_003f" accesskey="1">What is shortcuts?</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Database-connection" accesskey="2">Database connection</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Raw-SQL" accesskey="3">Raw SQL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#String-template" accesskey="4">String template</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SQL_002dMapping-shortcut-_0028unfinished_0029" accesskey="5">SQL-Mapping shortcut (unfinished)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authentication-1" accesskey="6">Authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="What-is-shortcuts_003f"></span><div class="header">
<p>
Next: <a href="#Database-connection" accesskey="n" rel="next">Database connection</a>, Up: <a href="#Shortcuts" accesskey="u" rel="up">Shortcuts</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="What-is-shortcuts_003f-1"></span><h3 class="section">23.1 What is shortcuts?</h3>

<p><em>shortcuts</em> are a series of special functions. They&rsquo;re used to simplify the complex
operations, according to the configuration specified by the related keyword, set
after a URL-rule.
</p>
<p>It was named <em>OHT</em> which stands for <em>Optional Handler Table</em>, which indicates the basic
principle to be implemented. But it was too hard to remember. So let&rsquo;s just call it <em>shortcut</em>.
</p>
<p>Anyway, you may find them in the module <a href="https://gitlab.com/NalaGinrut/artanis/blob/master/artanis/oht.scm">(artanis oht)</a>.
</p>
<p>It&rsquo;s good practice to use <em>shortcuts</em> as possible and avoid calling low-level APIs.
</p>
<p>Each shortcut consists of 2 parts: <strong>config</strong> and <strong>apply</strong>.
</p>
<p><strong>config</strong> is to configure a certain service for the specific URL rule. This configuration
will only be availble to this URL rule, and independent to other registered URL rules.
</p>
<p><strong>apply</strong> is used to call specific functions related to your configuration in the <strong>config</strong> step.
The first argument of the <strong>apply</strong> method must be a <code>route-context</code> (<a href="#Route-context">route context</a>).
</p>
<hr>
<span id="Database-connection"></span><div class="header">
<p>
Next: <a href="#Raw-SQL" accesskey="n" rel="next">Raw SQL</a>, Previous: <a href="#What-is-shortcuts_003f" accesskey="p" rel="prev">What is shortcuts?</a>, Up: <a href="#Shortcuts" accesskey="u" rel="up">Shortcuts</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Database-connection-1"></span><h3 class="section">23.2 Database connection</h3>

<p>This is a useful feature to use when you connect to a database.
The shortcut provides a way to interact with the raw connection.
The connection is fetched from the connection pool, which is created
at GNU Artanis&rsquo;s start up.
</p>
<div class="example">
<pre class="example">;; config
#:conn #t

;; apply
(:conn &lt;route-context&gt; [sql])
</pre></div>

<ul>
<li> The second argument is optional, if it&rsquo;s missing, then <code>:conn</code>
will return the raw connection after applying <code>(:conn rc)</code>.
<ul>
<li> NOTE: If you haven&rsquo;t set <code>#:conn #t</code>, and applied
<code>(:conn rc)</code>, then <code>(rc-conn rc)</code>
will return <code>#f</code>. This is why you shouldn&rsquo;t use low-level
<code>(rc-conn rc)</code>.
</li></ul>
</li><li> If you pass a second argument, it should be a valid SQL query string.
The returned value is described in <a href="#DB-connection-pool">DB connection pool</a>.
<ul>
<li> You can create the SQL query string with <a href="#SSQL">SSQL</a>.
</li></ul>
</li></ul>

<hr>
<span id="Raw-SQL"></span><div class="header">
<p>
Next: <a href="#String-template" accesskey="n" rel="next">String template</a>, Previous: <a href="#Database-connection" accesskey="p" rel="prev">Database connection</a>, Up: <a href="#Shortcuts" accesskey="u" rel="up">Shortcuts</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Raw-SQL-1"></span><h3 class="section">23.3 Raw SQL</h3>

<p>This shortcut is useful for a simple one-shot query.
</p>
<div class="example">
<pre class="example">;; config
#:raw-sql sql

;; apply
(:raw-sql &lt;route-context&gt; mode)
</pre></div>

<p><strong>Sql</strong> must be a valid SQL query string.
</p>
<p><strong>Mode</strong> is one of:
</p><ul>
<li> &rsquo;all for getting all the results.
</li><li> &rsquo;top for getting the first result.
</li><li> A positive integer to indicate how many results should be returned.
</li></ul>

<hr>
<span id="String-template"></span><div class="header">
<p>
Next: <a href="#SQL_002dMapping-shortcut-_0028unfinished_0029" accesskey="n" rel="next">SQL-Mapping shortcut (unfinished)</a>, Previous: <a href="#Raw-SQL" accesskey="p" rel="prev">Raw SQL</a>, Up: <a href="#Shortcuts" accesskey="u" rel="up">Shortcuts</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="String-template-1"></span><h3 class="section">23.4 String template</h3>

<p>This is a shortcut for <a href="#String-Template">string template</a>. Sometimes it&rsquo;s useful when you just need a quick way to
use a string template. It doesn&rsquo;t support multi templates, so if you do need to, please use
the traditional <a href="#String-Template">String Template</a>.
</p>
<div class="example">
<pre class="example">;; config
#:str &quot;string template&quot;

;; apply
(:str &lt;route-context&gt; key-values ...)
</pre></div>

<p>Please checkout <a href="#String-Template">string template</a> to find out how to use the <em>string-template</em> and <em>key-values</em>.
</p>
<hr>
<span id="SQL_002dMapping-shortcut-_0028unfinished_0029"></span><div class="header">
<p>
Next: <a href="#Authentication-1" accesskey="n" rel="next">Authentication 1</a>, Previous: <a href="#String-template" accesskey="p" rel="prev">String template</a>, Up: <a href="#Shortcuts" accesskey="u" rel="up">Shortcuts</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="SQL_002dMapping-shortcut-_0028unfinished_0029-1"></span><h3 class="section">23.5 SQL-Mapping shortcut (unfinished)</h3>

<p>This is related to <a href="#SQL-Mapping-_0028experimental_0029">SQL-Mapping</a>, which is still experimental, maybe you should wait for
the next version if you wish to use it.
</p>
<div class="example">
<pre class="example">;; config
#:sql-mapping config-patterns

;; apply
(:sql-mapping &lt;route-context&gt; command ...)
</pre></div>

<p><strong>config-patterns</strong> can be any of:
</p><ul>
<li> <code>#t</code> enable the simple sql-mapping.
</li><li> <code>`(path ,path ,name)</code>
Fetch the sql-mapping with <em>name</em> in the specified <em>path</em>.
<ul>
<li> <em>name</em> must be an object of the symbol type.
</li><li> <em>path</em> must be an object of the string type, and an existing path in your filesystem.
</li></ul>
</li><li> <code>`(add ,name ,sql-template)</code>
Fetch the sql-mapping with <em>name</em> rendered from <em>sql-template</em>.
<ul>
<li> <em>name</em> should be an object of the symbol type.
</li><li> <em>sql-template</em> is described in more detail in <a href="#SQL-Mapping-_0028experimental_0029">SQL-Mapping</a>.
</li></ul>
</li></ul>

<hr>
<span id="Authentication-1"></span><div class="header">
<p>
Previous: <a href="#SQL_002dMapping-shortcut-_0028unfinished_0029" accesskey="p" rel="prev">SQL-Mapping shortcut (unfinished)</a>, Up: <a href="#Shortcuts" accesskey="u" rel="up">Shortcuts</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Authentication-3"></span><h3 class="section">23.6 Authentication</h3>

<p>See <a href="#Authentication">Authentication</a>.
</p>
<hr>
<span id="Websocket-_0028Experimental_0029"></span><div class="header">
<p>
Next: <a href="#Ragnarok-server-core" accesskey="n" rel="next">Ragnarok server core</a>, Previous: <a href="#Shortcuts" accesskey="p" rel="prev">Shortcuts</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-_0028Experimental_0029-1"></span><h2 class="chapter">24 Websocket (Experimental)</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Websocket-introduction" accesskey="1">Websocket introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-basic-usage" accesskey="2">Websocket basic usage</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-named_002dpipe" accesskey="3">Websocket named-pipe</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-APIs" accesskey="4">Websocket APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-frame" accesskey="5">Websocket frame</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-opcode" accesskey="6">Websocket opcode</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-authentication" accesskey="7">Websocket authentication</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Websocket-introduction"></span><div class="header">
<p>
Next: <a href="#Websocket-basic-usage" accesskey="n" rel="next">Websocket basic usage</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-introduction-1"></span><h3 class="section">24.1 Websocket introduction</h3>

<p>Websockets are becoming more and more important for modern web development.
GNU Artanis is trying to provide an industrial strength and efficient Websocket implementation.
Websockets are important for GNU Artanis&rsquo;s design. Please see <a href="#Principles">Principles</a> for more details.
</p>
<hr>
<span id="Websocket-basic-usage"></span><div class="header">
<p>
Next: <a href="#Websocket-named_002dpipe" accesskey="n" rel="next">Websocket named-pipe</a>, Previous: <a href="#Websocket-introduction" accesskey="p" rel="prev">Websocket introduction</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-basic-usage-1"></span><h3 class="section">24.2 Websocket basic usage</h3>

<p>In GNU Artanis, a Websocket handling is triggered by setting it on a specific URL.
You should use <code>#:websocket</code> to configure the Websocket.
Here&rsquo;s the API definition:
</p><div class="example">
<pre class="example">#:websocket (proto protocol-name ['inexclusive])
</pre></div>
<p><strong>&rsquo;inexclusive</strong> is optional. By default, each Websocket connection only servs one client.
However, sometimes we do need to multicast the messages to several clients. Enable <strong>&rsquo;inexclusive</strong> is the
easiest way, but it may cause the similar issue to file-description-leaking. There&rsquo;re two suggestions:
</p><ul>
<li> Set and check security token to prevent malicious programs establish massive connections.
</li><li> If you want to do muticasting as in pub/sub, then use different token or named-pipe to subscribe. And maintain
a subscribers table for multicasting.
</li></ul>

<p>Here&rsquo;s a simple example for common cases:
</p><div class="example">
<pre class="example">(use-modules (artanis artanis))

(get &quot;/echo&quot; #:websocket '(proto echo)
     (lambda (rc)
       (:websocket rc 'payload)))

(run #:port 3000)
</pre></div>

<p>In this simple test, we choose the simplest <strong>echo</strong> protocol of the Websocket.
This will return back the string sent from the client.
Let&rsquo;s also write a simple javascript function for the web frontend:
</p>
<div class="example">
<pre class="example">function WebSocketTest()
{
    if (&quot;WebSocket&quot; in window)
    {
        document.write(&quot;&lt;p&gt;WebSocket is supported by your Browser!&lt;/p&gt;&quot;);

        // Let us open a web socket
        var ws = new WebSocket(&quot;ws://localhost:3000/echo&quot;);

        ws.onopen = function()
        {
            // Web Socket is connected, send data using send()
            ws.send(&quot;hello world&quot;);
            document.write(&quot;&lt;p&gt;Message is sent...&lt;/p&gt;&quot;);
        };

        ws.onmessage = function (evt)
        {
            var received_msg = evt.data;
            document.write(&quot;&lt;p&gt;hello welcome...&lt;/p&gt;&quot;);
        };

        ws.onclose = function()
        {
            // websocket is closed.
            document.write(&quot;&lt;p&gt;Connection is closed...&lt;/p&gt;&quot;);
        };

        window.onbeforeunload = function(event) {
            socket.close();
        };
    }
    else
    {
        // Your browser doesn't support WebSockets
        document.write(&quot;&lt;p&gt;WebSocket NOT supported by your Browser!&lt;/p&gt;&quot;);
    }
}
</pre></div>

<hr>
<span id="Websocket-named_002dpipe"></span><div class="header">
<p>
Next: <a href="#Websocket-APIs" accesskey="n" rel="next">Websocket APIs</a>, Previous: <a href="#Websocket-basic-usage" accesskey="p" rel="prev">Websocket basic usage</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-named_002dpipe-1"></span><h3 class="section">24.3 Websocket named-pipe</h3>

<p>Artanis provides the named-pipe based on Websocket, which is very useful to interact between the client and server.
<em>NOTE: The Websocket named-pipe is very useful to implement server-push messaging.</em>
</p>
<p>Here is the critical API:
</p><div class="example">
<pre class="example">(named-pipe-subscribe &lt;route-context&gt;)
</pre></div>

<p>Let&rsquo;s try a simple example:
</p><div class="example">
<pre class="example">(get &quot;/robot&quot; #:websocket '(proto echo) named-pipe-subscribe)
</pre></div>

<p>Here we register a WebAPI named <code>&quot;/robot&quot;</code>, and configure it a Websocket API by
<code>#:websocket '(proto echo)</code>. As you may see, we specify its protocol to a simple echo protocal,
it is to say, it will redirect what it receives. Each time it receives a message, it will redirect the message to the
specified named-pipe, and the subscriber of that named-pipe will get the message instantly. The name of the pipe is specified
by the client like this:
</p><div class="example">
<pre class="example">var ws = new WebSocket(&quot;ws://localhost:3000/robot?artanis_named_pipe=robot-1&quot;);
</pre></div>
<p>The query-string <code>&quot;artanis_named_pipe&quot;</code> is a special key in Artanis, you MUST use this key to specify the
pipe name. Here we specify the pipe name as <code>&quot;robot-1&quot;</code>.
</p>
<p>Now we setup the named-pipe, however, we still need to setup another WebAPI to let the client send message:
</p><div class="example">
<pre class="example">(get &quot;/welcome/:whom/:what&quot; #:websocket 'send-only
     (lambda (rc)
       (:websocket rc 'send (params rc &quot;whom&quot;) (params rc &quot;what&quot;))
       &quot;ok&quot;))
</pre></div>
<p>The configure <code>&quot;#:websocket 'send-only&quot;</code> means this API is only for sending, so that it&rsquo;s half-duplex.
And another critical Websocket API here:
</p><div class="example">
<pre class="example">(:websocket &lt;route-context&gt; 'send &lt;pipe-name&gt; &lt;data&gt;)
</pre></div>

<p>Each time you send data from the WebAPI, for example:
</p><div class="example">
<pre class="example">curl localhost:3000/welcome/robot-1/nala
</pre></div>
<p>In our simple example of <a href="https://gitlab.com/NalaGinrut/artanis/blob/master/examples/websocket-named-pipe.html">Websocket named-pipe test</a>, you should run
The named-pipe will receive the message <code>&quot;nala&quot;</code>,
and the page on the browser will print <code>&quot;hello welcome...nala&quot;</code> instantly.
</p>
<hr>
<span id="Websocket-APIs"></span><div class="header">
<p>
Next: <a href="#Websocket-frame" accesskey="n" rel="next">Websocket frame</a>, Previous: <a href="#Websocket-named_002dpipe" accesskey="p" rel="prev">Websocket named-pipe</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-APIs-1"></span><h3 class="section">24.4 Websocket APIs</h3>

<p><strong>NOTE: The Websocket is in a very preliminary stage. It only support echo.</strong>
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Websocket-configuration" accesskey="1">Websocket configuration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Websocket-application" accesskey="2">Websocket application</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Websocket-configuration"></span><div class="header">
<p>
Next: <a href="#Websocket-application" accesskey="n" rel="next">Websocket application</a>, Up: <a href="#Websocket-APIs" accesskey="u" rel="up">Websocket APIs</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-configuration-1"></span><h4 class="subsection">24.4.1 Websocket configuration</h4>

<div class="example">
<pre class="example">#:websocket `(proto ,protocol_name)
</pre></div>
<p><strong>protocol_name</strong> can be:
</p><ul>
<li> <strong>&rsquo;echo</strong> for a simple echo test.
<strong>NOTE:</strong> More protocols will be added in the future.

<div class="example">
<pre class="example">#:websocket simple_pattern
</pre></div>
<p><strong>simple_pattern</strong> can be:
</p><ul>
<li> <strong>#t</strong> or <strong>&rsquo;raw</strong> will enable a WebSocket on this URL without specifying the protocol.
So you will get the raw data from the decoded payload.
</li></ul>

<div class="example">
<pre class="example">#:websocket `(redirect ,ip/usk)
</pre></div>
<p>This is used for redirecting a Websocket stream to another address.
ip/usk is an ip or a unix-socket. The string regexp pattern has to match:
</p><ul>
<li> <code>^ip://(?:[0-9]{1,3}\\.){3}[0-9]{1,3}(:[0-9]{1,5})?$</code>
</li><li> <code>^unix://[a-zA-Z-_0-9]+\\.socket$</code>
</li></ul>

<div class="example">
<pre class="example">#:websocket `(proxy ,protocol)
</pre></div>
<p>Setup a proxy with a specific protocol handler.
Unlike the regular proxy approach, the proxy in Artanis doesn&rsquo;t
need a listening port. Since it&rsquo;s always 80/443 or a custom port.
The client has to have websocket support. And be able to access the specified URL
to establish a websocket connection. The rest is the same as with a regular proxy.
</p></li></ul>

<hr>
<span id="Websocket-application"></span><div class="header">
<p>
Previous: <a href="#Websocket-configuration" accesskey="p" rel="prev">Websocket configuration</a>, Up: <a href="#Websocket-APIs" accesskey="u" rel="up">Websocket APIs</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-application-1"></span><h4 class="subsection">24.4.2 Websocket application</h4>

<div class="example">
<pre class="example">(:websocket &lt;route-context&gt; command)
</pre></div>
<p><strong>command</strong> can be:
</p><ul>
<li> <strong>&rsquo;payload</strong> to get the decoded data from the client. It&rsquo;s decoded from Websocket frame automatically.
So you don&rsquo;t have to parse the frame.
</li></ul>

<hr>
<span id="Websocket-frame"></span><div class="header">
<p>
Next: <a href="#Websocket-opcode" accesskey="n" rel="next">Websocket opcode</a>, Previous: <a href="#Websocket-APIs" accesskey="p" rel="prev">Websocket APIs</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-frame-1"></span><h3 class="section">24.5 Websocket frame</h3>

<p>GNU Artanis provides a Websocket data frame struct, as defined in <a href="https://tools.ietf.org/html/rfc6455">RFC6455</a>.
</p>
<p>The frame will not be decoded or parsed into a record-type, but will be kept as the binary
frame read from the client, and use bitwise operations to fetch fields.
This kind of &lsquo;lazy&rsquo; design saves much time as it doesn&rsquo;t parse unused fields, and makes
it easier to redirect without any serialization.
If users want to get a certain field, Artanis provides APIs for fetching them.
Users can decide how to parse the frames by themselves, which we think is more efficient.
</p>
<p>Here are the APIs you can use:
</p>
<div class="example">
<pre class="example">(websocket-frame? &lt;websocket-frame&gt;)
</pre></div>

<div class="example">
<pre class="example">;; parser: bytevector -&gt; custom data frame
(websocket-frame-parser &lt;websocket-frame&gt;)
</pre></div>

<p><strong>websocket-frame-parser</strong> is the registered reader for the protocol specified by the
<code>#:websocket</code> configuration. The protocol is customizable based on protobuf.
<em>NOTE: Custom protocols support hasn&rsquo;t been implemented yet.</em>
</p>
<div class="example">
<pre class="example">(websocket-frame-head &lt;websocket-frame&gt;)
(websocket-frame-final-fragment? &lt;websocket-frame&gt;)
(websocket-frame-opcode &lt;websocket-frame&gt;)
(websocket-frame-payload &lt;websocket-frame&gt;)
(websocket-frame-mask &lt;websocket-frame&gt;)
</pre></div>
<p>To get the Websocket frame information. See <a href="https://tools.ietf.org/html/rfc6455#page-27">Data framing</a> for details.
</p><ul>
<li> <strong>head</strong> returns the first 2 bytes in the data frame.
</li><li> <strong>final-fragment</strong> returns true if it&rsquo;s the last frame in a session.
</li><li> <strong>opcode</strong> returns the opcode in the frame. Refer to <a href="#Websocket-opcode">Websocket opcode</a>.
</li><li> <strong>payload</strong> returns the actual encoded data.
</li><li> <strong>mask</strong> returns the frame mask.
</li></ul>

<hr>
<span id="Websocket-opcode"></span><div class="header">
<p>
Next: <a href="#Websocket-authentication" accesskey="n" rel="next">Websocket authentication</a>, Previous: <a href="#Websocket-frame" accesskey="p" rel="prev">Websocket frame</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-opcode-1"></span><h3 class="section">24.6 Websocket opcode</h3>

<p>Opcode defines the interpretation of &quot;Payload data&quot;. If an unknown opcode is received,
the receiving endpoint&rsquo;s WebSocket connection will fail.
</p>
<div class="example">
<pre class="example">;;  check if it's a continuation frame
(is-continue-frame? opcode)

;;  check if it's text frame
(is-text-frame? opcode)

;; check if it's binary frame
(is-binary-frame? opcode)

;; check if it's control frame
(is-control-frame? opcode)
(is-non-control-frame? opcode)

;;  websocket requires closing
(is-close-frame? opcode)

;;  check if it's a ping frame
(is-ping-frame? opcode)

;;  check if it's a pong frame
(is-pong-frame? opcode)

;;  %xB-F are reserved for further control frames
(is-reserved-frame? opcode)

</pre></div>

<hr>
<span id="Websocket-authentication"></span><div class="header">
<p>
Previous: <a href="#Websocket-opcode" accesskey="p" rel="prev">Websocket opcode</a>, Up: <a href="#Websocket-_0028Experimental_0029" accesskey="u" rel="up">Websocket (Experimental)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Websocket-authentication-1"></span><h3 class="section">24.7 Websocket authentication</h3>

<p>The Websocket authentication hasn&rsquo;t been unsupported yet.
</p>
<hr>
<span id="Ragnarok-server-core"></span><div class="header">
<p>
Next: <a href="#Key_002dValue-Database" accesskey="n" rel="next">Key-Value Database</a>, Previous: <a href="#Websocket-_0028Experimental_0029" accesskey="p" rel="prev">Websocket (Experimental)</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Ragnarok-server-core-1"></span><h2 class="chapter">25 Ragnarok server core</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Introduction-1" accesskey="1">Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Principles" accesskey="2">Principles</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Features" accesskey="3">Features</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Ragnarok-APIs" accesskey="4">Ragnarok APIs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="Introduction-1"></span><div class="header">
<p>
Next: <a href="#Principles" accesskey="n" rel="next">Principles</a>, Up: <a href="#Ragnarok-server-core" accesskey="u" rel="up">Ragnarok server core</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Introduction-3"></span><h3 class="section">25.1 Introduction</h3>

<p>Since version 0.2, GNU Artanis has started to use a strong server core for high concurrency.
Its name is Ragnarok.
In the philosophy of the design of GNU Artanis, everything is meant to be flexible and customizable.
The server core is no exception. In case Ragnarok doesn&rsquo;t suit your needs, you&rsquo;re free to use something else.
</p>
<p>Ragnarok doesn&rsquo;t use any popular library for handling events (libev/libuv etc &hellip;).
It&rsquo;s a brand new server core based on epoll and <a href="https://en.wikipedia.org/wiki/Delimited_continuation">delimited continuations</a>.
</p>
<hr>
<span id="Principles"></span><div class="header">
<p>
Next: <a href="#Features" accesskey="n" rel="next">Features</a>, Previous: <a href="#Introduction-1" accesskey="p" rel="prev">Introduction 1</a>, Up: <a href="#Ragnarok-server-core" accesskey="u" rel="up">Ragnarok server core</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Principles-1"></span><h3 class="section">25.2 Principles</h3>

<p>A basic characteristic of Ragnarok is the use of co-routines. These co-routines are implemented with <a href="https://en.wikipedia.org/wiki/Delimited_continuation">delimited continuations</a>.
There are no OS/kernel controlled threads, like pthread, for scheduling <em>request-handlers</em> in Ragnarok.
All the tasks are scheduled by a userland scheduler. And the task is nothing but just a special continuation.
The key difference between this and a regular <a href="https://en.wikipedia.org/wiki/Call-with-current-continuation#Criticism">full-stack continuation</a>, is that you can set
limits with precision, instead of having to capture the whole stack.
</p>
<p>For researchers, there is a paper published on <a href="http://www.schemeworkshop.org/2016/">ICFP Scheme Workshop 2016 conference</a> to explain the principle and
the design of GNU Artanis:
</p>
<p><a href="https://github.com/NalaGinrut/artanis/raw/gh-pages/research/scheme16/art2016.pdf">Multi-purpose web framework design based on websockets over HTTP Gateway</a>.
</p>
<p>(to be continued &hellip;)
</p>
<hr>
<span id="Features"></span><div class="header">
<p>
Next: <a href="#Ragnarok-APIs" accesskey="n" rel="next">Ragnarok APIs</a>, Previous: <a href="#Principles" accesskey="p" rel="prev">Principles</a>, Up: <a href="#Ragnarok-server-core" accesskey="u" rel="up">Ragnarok server core</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Features-1"></span><h3 class="section">25.3 Features</h3>

<p>In Artanis, the request handling can be scheduled even when the socket buffer is full (depends on <code>server.bufsize</code>).
And let other handlers deal with the requests. Just like the scheduling of an OS, but in userland.
</p>
<p>If you have issues with the buffer when scheduling, there&rsquo;s no way to flush before it breaks,
since we can&rsquo;t tell if the scheduling is caused by the buffering or the blocking.
</p>
<p>Ragnarok takes advantage of <code>SO_REUSEPORT</code> introduced in GNU/Linux 3.9 to provide a feature
named <code>server.multi</code> which can be enabled in the config. This feature allows users to start several
Artanis instances listening to the same port, to take advantage of multi core CPUs, and the Linux Kernel managing the events.
</p>
<p>(to be continued &hellip;)
</p>
<hr>
<span id="Ragnarok-APIs"></span><div class="header">
<p>
Previous: <a href="#Features" accesskey="p" rel="prev">Features</a>, Up: <a href="#Ragnarok-server-core" accesskey="u" rel="up">Ragnarok server core</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Ragnarok-APIs-1"></span><h3 class="section">25.4 Ragnarok APIs</h3>

<p>You can use these APIs to customize your own server core.
</p>
<p>(to be continued &hellip;)
</p>
<hr>
<span id="Key_002dValue-Database"></span><div class="header">
<p>
Next: <a href="#Utils" accesskey="n" rel="next">Utils</a>, Previous: <a href="#Ragnarok-server-core" accesskey="p" rel="prev">Ragnarok server core</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Key_002dValue-Database-1"></span><h2 class="chapter">26 Key-Value Database</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#LPC" accesskey="1">LPC</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="LPC"></span><div class="header">
<p>
Up: <a href="#Key_002dValue-Database" accesskey="u" rel="up">Key-Value Database</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="LPC-1"></span><h3 class="section">26.1 LPC</h3>

<p>LPC stands for Lightweight Persistent Cache. It&rsquo;s the easiest way to use key-value DB in Artanis.
</p>
<p>For example:
</p><div class="example">
<pre class="example">(get &quot;/certain_rule&quot; #:lpc &lt;backend&gt; (lambda (rc) ...))
</pre></div>

<p>The backend includes:
</p><ul>
<li> <code>#t</code> or <code>'redis</code>
</li><li> <code>'json</code>
</li></ul>

<p>After configured, it&rsquo;s easy to use it:
</p><div class="example">
<pre class="example">;; Setter
(:lpc rc 'set &lt;key&gt; &lt;val&gt;)

;; Getter
(:lpc rc 'get &lt;key&gt;)
;; or
(:lpc rc 'ref &lt;key&gt;)
</pre></div>

<p>In default, the key will be prefixed automatically:
</p><div class="example">
<pre class="example">(string-append &quot;__artanis_lpc_&quot; (get-conf '(db name)) &quot;_&quot; key)
</pre></div>

<hr>
<span id="Utils"></span><div class="header">
<p>
Next: <a href="#Integrate-front_002dend-framework" accesskey="n" rel="next">Integrate front-end framework</a>, Previous: <a href="#Key_002dValue-Database" accesskey="p" rel="prev">Key-Value Database</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Utils-1"></span><h2 class="chapter">27 Utils</h2>

<p><strong>The functions listed below require the <a href="https://gitlab.com/NalaGinrut/artanis/blob/master/artanis/utils.scm">(artanis utils)</a> module.</strong>
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#String-Template" accesskey="1">String Template</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Random-String-Generator" accesskey="2">Random String Generator</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Cryptographic-hash-functions" accesskey="3">Cryptographic hash functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Stack-_0026-Queue" accesskey="4">Stack &amp; Queue</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Useful-string-operation" accesskey="5">Useful string operation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Time-operation-tool" accesskey="6">Time operation tool</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="String-Template"></span><div class="header">
<p>
Next: <a href="#Random-String-Generator" accesskey="n" rel="next">Random String Generator</a>, Up: <a href="#Utils" accesskey="u" rel="up">Utils</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="String-Template-1"></span><h3 class="section">27.1 String Template</h3>

<p>GNU Artanis provides Python3-like template strings:
</p><div class="example">
<pre class="example">(make-string-template tpl . vals)
</pre></div>

<ul>
<li> <strong>tpl</strong> stands for template string.
</li><li> <strong>vals</strong> is varg-list specifying default value to certain key.
</li></ul>

<p>For example:
</p><div class="example">
<pre class="example">(define st (make-string-template &quot;hello ${name}&quot;))
(st #:name &quot;nala&quot;)
;; ==&gt; &quot;hello nala&quot;

;; or you may specify a default value for ${name}
(define st (make-string-template &quot;hello ${name}&quot; #:name &quot;unknown&quot;))
(st)
;; ==&gt; &quot;hello unknown&quot;
(st #:name &quot;john&quot;)
;; ==&gt; &quot;hello john&quot;
</pre></div>

<hr>
<span id="Random-String-Generator"></span><div class="header">
<p>
Next: <a href="#Cryptographic-hash-functions" accesskey="n" rel="next">Cryptographic hash functions</a>, Previous: <a href="#String-Template" accesskey="p" rel="prev">String Template</a>, Up: <a href="#Utils" accesskey="u" rel="up">Utils</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Random-String-Generator-1"></span><h3 class="section">27.2 Random String Generator</h3>

<p>Get random string from &lsquo;<samp>/dev/urandom</samp>&rsquo;.
</p><div class="example">
<pre class="example">(get-random-from-dev #:length 8 #:uppercase #f)
</pre></div>

<hr>
<span id="Cryptographic-hash-functions"></span><div class="header">
<p>
Next: <a href="#Stack-_0026-Queue" accesskey="n" rel="next">Stack &amp; Queue</a>, Previous: <a href="#Random-String-Generator" accesskey="p" rel="prev">Random String Generator</a>, Up: <a href="#Utils" accesskey="u" rel="up">Utils</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Cryptographic-hash-functions-1"></span><h3 class="section">27.3 Cryptographic hash functions</h3>

<div class="example">
<pre class="example">;; hash a string with MD5
(string-&gt;md5 str)
;; hash a string with SHA-1
(string-&gt;sha-1 str)
</pre></div>

<p>SHA-2 hash functions are also supported from Artanis-0.2.5.
</p><div class="example">
<pre class="example">(string-&gt;sha-224 str)
(string-&gt;sha-384 str)
(string-&gt;sha-512 str)
</pre></div>

<hr>
<span id="Stack-_0026-Queue"></span><div class="header">
<p>
Next: <a href="#Useful-string-operation" accesskey="n" rel="next">Useful string operation</a>, Previous: <a href="#Cryptographic-hash-functions" accesskey="p" rel="prev">Cryptographic hash functions</a>, Up: <a href="#Utils" accesskey="u" rel="up">Utils</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Stack-_0026-Queue-1"></span><h3 class="section">27.4 Stack &amp; Queue</h3>

<p>GNU Artanis provides simple interfaces for stack &amp; queue:
</p><div class="example">
<pre class="example">;; stack operations
(new-stack)
(stack-pop! stk)
(stack-push! stk elem)
(stack-top stk)
(stack-remove! stk key)
(stack-empty? stk)

;; queue operations
(new-queue)
(queue-out! q)
(queue-in! q elem)
(queue-head q)
(queue-tail q)
(queue-remove! q key)
(queue-empty? q)
</pre></div>

<hr>
<span id="Useful-string-operation"></span><div class="header">
<p>
Next: <a href="#Time-operation-tool" accesskey="n" rel="next">Time operation tool</a>, Previous: <a href="#Stack-_0026-Queue" accesskey="p" rel="prev">Stack &amp; Queue</a>, Up: <a href="#Utils" accesskey="u" rel="up">Utils</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Useful-string-operation-1"></span><h3 class="section">27.5 Useful string operation</h3>

<p>If you want to get all the contents from a file into a string,
then don&rsquo;t use <code>get-string-all</code> imported from rnrs. Because it
will not detect the correct charset from the locale, and this may cause the length differ
from the actual value. Although GNU Artanis can handle this length issue properly, you
should use <code>get-string-all-with-detected-charset</code> when you need
to do something like this. If you don&rsquo;t care about the contents encoding but just want
to get the them, it&rsquo;s better to use <code>get-bytevector-all</code> imported
from rnrs.
</p><div class="example">
<pre class="example">(get-string-all-with-detected-charset filename)
</pre></div>

<hr>
<span id="Time-operation-tool"></span><div class="header">
<p>
Previous: <a href="#Useful-string-operation" accesskey="p" rel="prev">Useful string operation</a>, Up: <a href="#Utils" accesskey="u" rel="up">Utils</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Time-operation-tool-1"></span><h3 class="section">27.6 Time operation tool</h3>

<p>TODO
</p>
<hr>
<span id="Integrate-front_002dend-framework"></span><div class="header">
<p>
Next: <a href="#Debug-mode" accesskey="n" rel="next">Debug mode</a>, Previous: <a href="#Utils" accesskey="p" rel="prev">Utils</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Integrate-front_002dend-framework-1"></span><h2 class="chapter">28 Integrate front-end framework</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#React-_002b-Typescript" accesskey="1">React + Typescript</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<span id="React-_002b-Typescript"></span><div class="header">
<p>
Up: <a href="#Integrate-front_002dend-framework" accesskey="u" rel="up">Integrate front-end framework</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="React-_002b-Typescript-1"></span><h3 class="section">28.1 React + Typescript</h3>

<p>It is strongly recommended to use Typescript to replace Javascript.
And Typescript transpiler is licensed with Apache-2.0 which is compatible with GPL.
Although Typescript was dismissed because of the size and little slower performance,
the rubustness should be more important in the development.
</p>
<p>Here is an example for Hello World.
</p>
<p>We assume that you’re already using Node.js with npm.
</p>
<p>For example, you have an Artanis application:
</p>
<div class="example">
<pre class="example">art create my-test
cd my-test
</pre></div>

<p>However, the <strong>node_modules</strong> directory can&rsquo;t be put in the toplevel position.
You have to initialize your NPM in <strong>pub</strong> directory:
</p><div class="example">
<pre class="example"># In my-test directory
cd pub
npm init
</pre></div>

<p>You’ll be given a series of prompts, but you can feel free to use the defaults. You can always go back and change these in the package.json file that’s been generated for you.
If you want to skip those prompts, just type:
</p><div class="example">
<pre class="example"># In *pub* directory
npm init -y
</pre></div>

<p>Let’s now add React and React-DOM, along with their declaration files, as dependencies to your package.json file:
</p><div class="example">
<pre class="example"># In *pub* directory
npm install --save react react-dom @types/react @types/react-dom
</pre></div>

<p>Next, we’ll install Webpack and the Webpack CLI as dev-dependencies, add development-time dependencies on awesome-typescript-loader and source-map-loader.
</p><div class="example">
<pre class="example">npm install --save-dev webpack webpack-cli typescript awesome-typescript-loader source-map-loader
</pre></div>

<p>Create and edit <strong>tsconfig.json</strong> file under <strong>pub</strong> directory:
</p><div class="example">
<pre class="example">{
    &quot;compilerOptions&quot;: {
        &quot;outDir&quot;: &quot;./pub/dist/&quot;,
        &quot;sourceMap&quot;: true,
        &quot;noImplicitAny&quot;: true,
        &quot;module&quot;: &quot;commonjs&quot;,
        &quot;target&quot;: &quot;es6&quot;,
        &quot;jsx&quot;: &quot;react&quot;
    },
    &quot;include&quot;: [
        &quot;./pub/js/ts/**/*&quot;
    ],
    &quot;exclude&quot;: [&quot;node_modules&quot;]
}
</pre></div>

<p>Create and edit <strong>webpack.config.js</strong> file under <strong>pub</strong> directory:
</p><div class="example">
<pre class="example">module.exports = {
    mode: 'production',
    watch: true,
    entry: &quot;./js/ts/index.tsx&quot;,
    output: {
        filename: &quot;bundle.js&quot;,
        path: __dirname + &quot;/dist&quot;
    },

    // Enable sourcemaps for debugging webpack's output.
    devtool: &quot;source-map&quot;,

    resolve: {
        // Add '.ts' and '.tsx' as resolvable extensions.
        extensions: [&quot;.ts&quot;, &quot;.tsx&quot;, &quot;.js&quot;, &quot;.json&quot;]
    },

    module: {
        rules: [
            // All files with a '.ts' or '.tsx' extension will be handled by 'awesome-typescript-loader'.
            { test: /\.tsx?$/, loader: &quot;awesome-typescript-loader&quot; },

            // All output '.js' files will have any sourcemaps re-processed by 'source-map-loader'.
            { enforce: &quot;pre&quot;, test: /\.js$/, loader: &quot;source-map-loader&quot; }
        ]
    },

    // When importing a module whose path matches one of the following, just
    // assume a corresponding global variable exists and use that instead.
    // This is important because it allows us to avoid bundling all of our
    // dependencies, which allows browsers to cache those libraries between builds.
    externals: {
        &quot;react&quot;: &quot;React&quot;,
        &quot;react-dom&quot;: &quot;ReactDOM&quot;
    }
};
</pre></div>

<p>Create <strong>index.html</strong> under <strong>pub</strong> directory:
</p><div class="example">
<pre class="example">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;title&gt;Hello React!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;example&quot;&gt;&lt;/div&gt;

    &lt;!-- Dependencies --&gt;
    &lt;script src=&quot;./node_modules/react/umd/react.development.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;./node_modules/react-dom/umd/react-dom.development.js&quot;&gt;&lt;/script&gt;

    &lt;!-- Main --&gt;
    &lt;script src=&quot;./dist/bundle.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div>

<p>Create <strong>js/ts/index.tsx</strong> under <strong>pub</strong> directory:
</p><div class="example">
<pre class="example">import * as React from &quot;react&quot;;
import * as ReactDOM from &quot;react-dom&quot;;

import { Hello } from &quot;./components/Hello&quot;;

ReactDOM.render(
        &lt;Hello compiler=&quot;TypeScript&quot; framework=&quot;React&quot; /&gt;,
    document.getElementById(&quot;example&quot;)
);
</pre></div>

<p>Create <strong>js/ts/components/Hello.tsx</strong> under <strong>pub</strong> directory:
</p><div class="example">
<pre class="example">import * as React from &quot;react&quot;;

export interface HelloProps {
    compiler: string;
    framework: string;
}

export const Hello = (props: HelloProps) =&gt;
    &lt;h1&gt;Hello from {props.compiler} and {props.framework}!&lt;/h1&gt;;
</pre></div>

<p>Webpack 4 has two modes: development and production. The bundle will be minimized on production mode only.
Let’s add two npm scripts to our package.json to run Webpack:
</p><div class="example">
<pre class="example">&quot;scripts&quot;: {
    &quot;start&quot;: &quot;webpack --mode development&quot;,
    &quot;build&quot;: &quot;webpack --mode production&quot;
  },
</pre></div>

<p>Now, everything is ready, we run <strong>webpack</strong> to compile Typescript code and pack necessary resources:
</p><div class="example">
<pre class="example"># Must be under &quot;pub&quot; directory
npm run build
</pre></div>
<p>So webpack is watching your code, anytime you change the code, webpack will automatically update it.
</p>
<p>Then, under project folders, open a new terminal, and type:
</p><div class="example">
<pre class="example">art work
</pre></div>

<p>OK, now open <strong><a href="http://localhost:3000/pub/index.html">http://localhost:3000/pub/index.html</a></strong> to see your work.
</p>
<p>It&rsquo;s just a Hello World. Feel free to modify it for your cases.
</p>
<hr>
<span id="Debug-mode"></span><div class="header">
<p>
Next: <a href="#Appendix-A-GNU-Free-Documentation-License" accesskey="n" rel="next">Appendix A GNU Free Documentation License</a>, Previous: <a href="#Integrate-front_002dend-framework" accesskey="p" rel="prev">Integrate front-end framework</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Debug-mode-1"></span><h2 class="chapter">29 Debug mode</h2>

<p>GNU Artanis provides a debug-mode for a more convenient way to debug. It&rsquo;s very easy to use.
</p>
<p>For the simplest way, pass <code>#:debug #t</code> when calling <code>run</code> function:
</p><div class="example">
<pre class="example">(run #:debug #t)
</pre></div>

<p>If you are using the MVC system, or created a project directory, just pass &ndash;debug or -g to art:
</p><div class="example">
<pre class="example"># In the project directory
art work --debug
# Or
art work -g
</pre></div>

<p>When you enable debug-mode, the Model and Controller modules in the directory  will be reloaded automatically every time they&rsquo;re called.
</p>
<p>When <strong><em>not</em></strong> in debug mode, you have to press Ctrl+C to quit GNU Artanis server and start it again to test changed modules. Debug mode saves time when testing.
</p>
<p>You can add paths to monitor certain files (for example, a JSON file as config file to be reloaded on the fly).
If you want to be notified when they&rsquo;re changed. Just put
the paths here:
</p><div class="example">
<pre class="example">debug.monitor = my/lib/json, my/lib/modules
</pre></div>

<hr>
<span id="Appendix-A-GNU-Free-Documentation-License"></span><div class="header">
<p>
Previous: <a href="#Debug-mode" accesskey="p" rel="prev">Debug mode</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>]</p>
</div>
<span id="Appendix-A-GNU-Free-Documentation-License-1"></span><h2 class="chapter">30 Appendix A GNU Free Documentation License</h2>

<p>Version 1.3, 3 November 2008
Copyright © 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
<a href="http://fsf.org/">http://fsf.org/</a>
</p>
<p>Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
PREAMBLE
The purpose of this License is to make a manual, textbook, or other functional and useful document free in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.
</p>
<p>This License is a kind of “copyleft”, which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.
</p>
<p>We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.
</p>
<p>APPLICABILITY AND DEFINITIONS
This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein. The “Document”, below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as “you”. You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.
</p>
<p>A “Modified Version” of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.
</p>
<p>A “Secondary Section” is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document’s overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.
</p>
<p>The “Invariant Sections” are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License. If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant. The Document may contain zero Invariant Sections. If the Document does not identify any Invariant Sections then there are none.
</p>
<p>The “Cover Texts” are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License. A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.
</p>
<p>A “Transparent” copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent. An image format is not Transparent if used for any substantial amount of text. A copy that is not “Transparent” is called “Opaque”.
</p>
<p>Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification. Examples of transparent image formats include PNG, XCF and JPG. Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.
</p>
<p>The “Title Page” means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, “Title Page” means the text near the most prominent appearance of the work’s title, preceding the beginning of the body of the text.
</p>
<p>The “publisher” means any person or entity that distributes copies of the Document to the public.
</p>
<p>A section “Entitled XYZ” means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language. (Here XYZ stands for a specific section name mentioned below, such as “Acknowledgements”, “Dedications”, “Endorsements”, or “History”.) To “Preserve the Title” of such a section when you modify the Document means that it remains a section “Entitled XYZ” according to this definition.
</p>
<p>The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document. These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.
</p>
<p>VERBATIM COPYING
You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.
</p>
<p>You may also lend copies, under the same conditions stated above, and you may publicly display copies.
</p>
<p>COPYING IN QUANTITY
If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document’s license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.
</p>
<p>If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.
</p>
<p>If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.
</p>
<p>It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.
</p>
<p>MODIFICATIONS
You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:
</p>
<p>Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.
List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.
State on the Title page the name of the publisher of the Modified Version, as the publisher.
Preserve all the copyright notices of the Document.
Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.
Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.
Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document’s license notice.
Include an unaltered copy of this License.
Preserve the section Entitled “History”, Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled “History” in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.
Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the “History” section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.
For any section Entitled “Acknowledgements” or “Dedications”, Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.
Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.
Delete any section Entitled “Endorsements”. Such a section may not be included in the Modified Version.
Do not retitle any existing section to be Entitled “Endorsements” or to conflict in title with any Invariant Section.
Preserve any Warranty Disclaimers.
If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version’s license notice. These titles must be distinct from any other section titles.
</p>
<p>You may add a section Entitled “Endorsements”, provided it contains nothing but endorsements of your Modified Version by various parties—for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.
</p>
<p>You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.
</p>
<p>The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.
</p>
<p>COMBINING DOCUMENTS
You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.
</p>
<p>The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.
</p>
<p>In the combination, you must combine any sections Entitled “History” in the various original documents, forming one section Entitled “History”; likewise combine any sections Entitled “Acknowledgements”, and any sections Entitled “Dedications”. You must delete all sections Entitled “Endorsements.”
</p>
<p>COLLECTIONS OF DOCUMENTS
You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.
</p>
<p>You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.
</p>
<p>AGGREGATION WITH INDEPENDENT WORKS
A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an “aggregate” if the copyright resulting from the compilation is not used to limit the legal rights of the compilation’s users beyond what the individual works permit. When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.
</p>
<p>If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document’s Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form. Otherwise they must appear on printed covers that bracket the whole aggregate.
</p>
<p>TRANSLATION
Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers. In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.
</p>
<p>If a section in the Document is Entitled “Acknowledgements”, “Dedications”, or “History”, the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.
</p>
<p>TERMINATION
You may not copy, modify, sublicense, or distribute the Document except as expressly provided under this License. Any attempt otherwise to copy, modify, sublicense, or distribute it is void, and will automatically terminate your rights under this License.
</p>
<p>However, if you cease all violation of this License, then your license from a particular copyright holder is reinstated (a) provisionally, unless and until the copyright holder explicitly and finally terminates your license, and (b) permanently, if the copyright holder fails to notify you of the violation by some reasonable means prior to 60 days after the cessation.
</p>
<p>Moreover, your license from a particular copyright holder is reinstated permanently if the copyright holder notifies you of the violation by some reasonable means, this is the first time you have received notice of violation of this License (for any work) from that copyright holder, and you cure the violation prior to 30 days after your receipt of the notice.
</p>
<p>Termination of your rights under this section does not terminate the licenses of parties who have received copies or rights from you under this License. If your rights have been terminated and not permanently reinstated, receipt of a copy of some or all of the same material does not give you any rights to use it.
</p>
<p>FUTURE REVISIONS OF THIS LICENSE
The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See <a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.
</p>
<p>Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License “or any later version” applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation. If the Document specifies that a proxy can decide which future versions of this License can be used, that proxy’s public statement of acceptance of a version permanently authorizes you to choose that version for the Document.
</p>
<p>RELICENSING
“Massive Multiauthor Collaboration Site” (or “MMC Site”) means any World Wide Web server that publishes copyrightable works and also provides prominent facilities for anybody to edit those works. A public wiki that anybody can edit is an example of such a server. A “Massive Multiauthor Collaboration” (or “MMC”) contained in the site means any set of copyrightable works thus published on the MMC site.
</p>
<p>“CC-BY-SA” means the Creative Commons Attribution-Share Alike 3.0 license published by Creative Commons Corporation, a not-for-profit corporation with a principal place of business in San Francisco, California, as well as future copyleft versions of that license published by that same organization.
</p>
<p>“Incorporate” means to publish or republish a Document, in whole or in part, as part of another Document.
</p>
<p>An MMC is “eligible for relicensing” if it is licensed under this License, and if all works that were first published under this License somewhere other than this MMC, and subsequently incorporated in whole or in part into the MMC, (1) had no cover texts or invariant sections, and (2) were thus incorporated prior to November 1, 2008.
</p>
<p>The operator of an MMC Site may republish an MMC contained in the site under CC-BY-SA on the same site at any time before August 1, 2009, provided the MMC is eligible for relicensing.
</p>
<p>ADDENDUM: How to use this License for your documents
</p>
<p>To use this License in a document you have written, include a copy of the License in the document and put the following copyright and license notices just after the title page:
</p>
<p>Copyright (C)  year  your name.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is included in the section entitled &ldquo;GNU
Free Documentation License&rdquo;.
If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts, replace the “with…Texts.” line with this:
</p>
<p>with the Invariant Sections being list their titles, with
the Front-Cover Texts being list, and with the Back-Cover Texts
being list.
If you have Invariant Sections without Cover Texts, or some other combination of the three, merge those two alternatives to suit the situation.
</p>
<p>If your document contains nontrivial examples of program code, we recommend releasing these examples in parallel under your choice of free software license, such as the GNU General Public License, to permit their use in free software.
</p>
<hr>



</body>
</html>
